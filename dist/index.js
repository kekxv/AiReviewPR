(()=>{"use strict";var __webpack_modules__={6866:function(__unused_webpack_module,exports,__nccwpck_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){if(r===undefined)r=s;var n=Object.getOwnPropertyDescriptor(t,s);if(!n||("get"in n?!t.__esModule:n.writable||n.configurable)){n={enumerable:true,get:function(){return t[s]}}}Object.defineProperty(e,r,n)}:function(e,t,s,r){if(r===undefined)r=s;e[r]=t[s]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s))__createBinding(t,e,s);__setModuleDefault(t,e);return t};var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:true});exports.aiCheckDiffContext=exports.getDiffItems=exports.getFileDiff=exports.aiGenerate=exports.addLineNumbersToDiff=void 0;const node_child_process_1=__nccwpck_require__(1421);const utils_1=__nccwpck_require__(6087);const prompt_1=__nccwpck_require__(2594);const https=__importStar(__nccwpck_require__(5692));const http=__importStar(__nccwpck_require__(8611));const openai_1=__importDefault(__nccwpck_require__(9633));async function getRequest(e,t){const s=e.startsWith("https")?https:http;return new Promise(((r,n)=>{const o=s.get(e,{headers:t},(e=>{let t="";e.on("data",(e=>t+=e));e.on("end",(()=>{try{r(JSON.parse(t))}catch(e){n(e)}}))}));o.on("error",(e=>n(e)))}))}function addLineNumbersToDiff(e){const t=e.split("\n");let s=[];let r=null;for(let e of t){if(e.startsWith("@@")){const t=e.match(/\+(\d+)/);if(t){r=parseInt(t[1])}s.push(e);continue}if(e.startsWith("---")||e.startsWith("+++")){s.push(e);continue}if(e.startsWith("+")){s.push(`Line ${r}: ${e}`);if(r!==null)r++}else if(e.startsWith(" ")){s.push(`Line ${r}: ${e}`);if(r!==null)r++}else if(e.startsWith("-")){s.push(`OLD: ${e}`)}else{s.push(e)}}return s.join("\n")}exports.addLineNumbersToDiff=addLineNumbersToDiff;const language=process.env.INPUT_LANGUAGE||process.env.LANGUAGE||"Chinese";let useChinese=language.toLowerCase()==="chinese"||(process.env.INPUT_CHINESE||process.env.CHINESE||"true").toLowerCase()!=="false";if(language.toLowerCase()!=="chinese"&&!process.env.INPUT_CHINESE&&!process.env.CHINESE){useChinese=false}const reviewers_prompt=process.env.INPUT_REVIEWERS_PROMPT||"";const include_files=(0,utils_1.split_message)(process.env.INPUT_INCLUDE_FILES||"");const exclude_files=(0,utils_1.split_message)(process.env.INPUT_EXCLUDE_FILES||"");const event_action=process.env.INPUT_EVENT_ACTION||"";const event_before=process.env.INPUT_EVENT_BEFORE||"";const force_full_review=(process.env.INPUT_REVIEW_PULL_REQUEST||"false").toLowerCase()==="true";async function getLastReviewedCommitId(){if(!process.env.INPUT_PULL_REQUEST_NUMBER)return null;let e=process.env.GITHUB_API_URL||"";if(e.endsWith("/"))e=e.slice(0,-1);const t=`${e}/repos/${process.env.INPUT_REPOSITORY}/pulls/${process.env.INPUT_PULL_REQUEST_NUMBER}/reviews`;try{const e=await getRequest(t,{Authorization:`token ${process.env.INPUT_TOKEN}`,"User-Agent":"AiReviewPR"});if(!Array.isArray(e)||e.length===0)return null;const s=e.sort(((e,t)=>new Date(t.submitted_at).getTime()-new Date(e.submitted_at).getTime()));const r=s[0];if(r&&r.commit_id){return r.commit_id}}catch(e){console.warn("[WARN] Failed to fetch reviews:",e)}return null}async function submitPullRequestReview(e,t,s,r){if(!process.env.INPUT_PULL_REQUEST_NUMBER)return{id:0};const n={body:e,event:t,commit_id:r,comments:[]};if(s.length>0){n.comments=s.map((e=>({path:e.path,new_position:e.line,body:e.start_line&&e.start_line!==e.line?`[Lines ${e.start_line}-${e.line}] ${e.body}`:e.body})))}return await(0,utils_1.post)({url:`${process.env.GITHUB_API_URL}/repos/${process.env.INPUT_REPOSITORY}/pulls/${process.env.INPUT_PULL_REQUEST_NUMBER}/reviews`,body:n,header:{Authorization:`token ${process.env.INPUT_TOKEN}`}})}async function aiGenerate({host:e,token:t,prompt:s,model:r,system:n}){const o=new openai_1.default({baseURL:e,apiKey:t||"ignored"});const i=await o.chat.completions.create({model:r,messages:[{role:"system",content:n},{role:"user",content:s}],temperature:.4,stream:true});let a="";for await(const e of i){const t=e.choices[0]?.delta?.content||"";if(t){a+=t;process.stdout.write(t)}}process.stdout.write("\n");return a}exports.aiGenerate=aiGenerate;function getFileDiff(e,t,s){return(0,node_child_process_1.execSync)(`git diff --unified=9999 "${e}" "${t}" -- "${s}"`,{encoding:"utf-8"})}exports.getFileDiff=getFileDiff;function commitExists(e){try{(0,node_child_process_1.execSync)(`git cat-file -e "${e}^{commit}"`,{stdio:"ignore"});return true}catch(e){return false}}function getChangedFiles(e,t){const s=(0,node_child_process_1.execSync)(`git diff --name-only "${e}" "${t}"`,{encoding:"utf-8"});return s.trim().split("\n").filter((e=>e))}async function getDiffItems(){const e=process.env.INPUT_BASE_REF||"";let t="";const s="HEAD";let r=false;const n=event_action.includes("sync");if(!force_full_review&&n){if(event_before&&event_before!=="null"){t=event_before;r=true}else{const e=await getLastReviewedCommitId();if(e){t=e;r=true}}}if(r&&!commitExists(t)){try{(0,node_child_process_1.execSync)(`git fetch origin ${t} --depth=1`,{stdio:"ignore"})}catch(e){}}if(!r||!commitExists(t)){t=`origin/${e}`;try{(0,node_child_process_1.execSync)(`git fetch origin ${e} --depth=1`,{stdio:"ignore"})}catch(e){}r=false}let o=[];try{const e=getChangedFiles(t,s);for(const r of e){if(include_files.length>0&&!(0,utils_1.doesAnyPatternMatch)(include_files,r))continue;if(exclude_files.length>0&&(0,utils_1.doesAnyPatternMatch)(exclude_files,r))continue;const e=getFileDiff(t,s,r);const n=addLineNumbersToDiff(e);if(n.trim().length>0){o.push({path:r,context:n})}}}catch(e){}return{items:o,isIncremental:r}}exports.getDiffItems=getDiffItems;async function aiCheckDiffContext(){const url=process.env.INPUT_HOST;const model=process.env.INPUT_MODEL;if(!url||!model){console.error("HOST and model are required.");if(require.main===require.cache[eval("__filename")])process.exit(1);return}const{items:items}=await getDiffItems();if(items.length===0)return;const system_prompt=reviewers_prompt||(0,prompt_1.take_system_prompt)(process.env.INPUT_PROMPT_GENRE||"numbered",language);let allComments=[];let fileSummaries=[];for(const e of items){try{const t=`\nReview the following <git_diff> and output issues in the specified format. If no issues, output "LGTM".\n\n<git_diff>\n${e.context}\n</git_diff>\n`;let s=await aiGenerate({host:url,token:process.env.INPUT_AI_TOKEN,prompt:t,model:model,system:system_prompt});if(!s)continue;const r=s.match(/^```(markdown)?\s*([\s\S]*?)\s*```$/i);if(r)s=r[2].trim();const n=(0,utils_1.parseAIReviewResponse)(s);if(n.comments.length>0)allComments.push(...n.comments);if(n.body)fileSummaries.push({path:e.path,summary:n.body})}catch(t){console.error("[ERROR] Failed to review file:",e.path,t)}}if(allComments.length>0||fileSummaries.length>0){let e=`# Review Summary\n\n`;if(fileSummaries.length>0){e+=fileSummaries.map((e=>`* **${e.path}**: ${e.summary.replace(/\n/g," ")}`)).join("\n")}const t=allComments.length>0?"COMMENT":"APPROVE";await submitPullRequestReview(e,t,allComments,process.env.GITHUB_SHA)}}exports.aiCheckDiffContext=aiCheckDiffContext;if(require.main===require.cache[eval("__filename")]){aiCheckDiffContext().catch(console.error)}},2594:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.take_system_prompt=t.system_prompt_numbered=void 0;function system_prompt_main(e){e=e||"Chinese";return`\nYou are a senior software engineer and a strict code reviewer. Your task is to review pull requests based on the provided git diffs.\n\n**Core Principles:**\n1.  **Conciseness:** Be extremely direct. Use imperative mood (e.g., "Fix potential null pointer" instead of "I think you should fix..."). No pleasantries or fluff.\n2.  **Relevance:** Focus ONLY on the changed lines (+/-) and their immediate impact. Ignore unrelated legacy code.\n3.  **Quality:** Focus on Logic, Security, Performance, and Maintainability. Skip minor style nits unless they severely affect readability.\n\n**Instructions:**\n1.  **Analyze:** Review the diff for bugs, risks, or anti-patterns.\n2.  **LGTM:** If the code is high quality and has no significant issues, output exactly "LGTM" and nothing else.\n3.  **Report:** If issues are found:\n    - Provide a **Single Sentence Summary** of the changes at the very top.\n    - List each issue using the Strict Format below.\n\n**Strict Format (for each issue):**\n---\nFile: <file_path>\nStartLine: <start_line_in_new_file>\nEndLine: <end_line_in_new_file>\nComment: [Score: <1-5>] <concise_description> <suggestion_if_necessary>\n---\n\n**Scoring Criteria:**\n- 5: Critical (Security hole, crash, data loss) - Blocking.\n- 4: High (Logic bug, major performance issue).\n- 3: Medium (Edge case missing, maintainability).\n- 1-2: Low (Minor optimization, naming).\n\n**Constraints:**\n- **Language:** Respond ONLY in ${e}.\n- **Line Numbers:** Must match the NEW (Head) version of the file.\n- **Output:** Do not wrap the output in markdown code blocks (like \`\`\`json). Just raw text with separators.\n\n**Example Output:**\n\nRefactored user authentication flow, but missing error handling in token validation.\n\n---\nFile: src/auth/service.ts\nStartLine: 45\nEndLine: 46\nComment: [Score: 5] Critical security risk. Token signature is not verified before decoding. Use \`jwt.verify()\` instead of \`jwt.decode()\`.\n---\nFile: src/utils/logger.ts\nStartLine: 12\nEndLine: 12\nComment: [Score: 2] Remove debug \`console.log\` before production.\n---\n`}function system_prompt_old(e){const t=e?"You must respond only in Chinese to all inquiries. Please provide clear and accurate answers in Chinese language.":"";return`\nYou are an expert developer, your task is to review a set of pull requests.\nYou are given a list of filenames and their partial contents, but note that you might not have the full context of the code.\n\nOnly review lines of code which have been changed (added or removed) in the pull request. The code looks similar to the output of a git diff command. Lines which have been removed are prefixed with a minus (-) and lines which have been added are prefixed with a plus (+). Other lines are added to provide context but should be ignored in the review.\n\nBegin your review by evaluating the changed code using a risk score similar to a LOGAF score but measured from 1 to 5, where 1 is the lowest risk to the code base if the code is merged and 5 is the highest risk which would likely break something or be unsafe.\n\nIn your feedback, focus on highlighting potential bugs, improving readability if it is a problem, making code cleaner, and maximising the performance of the programming language. Flag any API keys or secrets present in the code in plain text immediately as highest risk. Rate the changes based on SOLID principles if applicable.\n\nDo not comment on breaking functions down into smaller, more manageable functions unless it is a huge problem. Also be aware that there will be libraries and techniques used which you are not familiar with, so do not comment on those unless you are confident that there is a problem.\n\nUse markdown formatting for the feedback details. Also do not include the filename or risk level in the feedback details.\n\nEnsure the feedback details are brief, concise, accurate. If there are multiple similar issues, only comment on the most critical.\n\nInclude brief example code snippets in the feedback details for your suggested changes when you're confident your suggestions are improvements. Use the same programming language as the file under review.\nIf there are multiple improvements you suggest in the feedback details, use an ordered list to indicate the priority of the changes.\n\n${t}\n\nPlease respond without using "\`\`\`markdown"\n`}function system_prompt_numbered(e){return`\nYou are a pragmatic Senior Technical Lead. Review the provided git diff FOCUSING on the changed lines (prefixed with '+' or '-').\n\n**INPUT DATA FORMAT:**\nYou will receive a <git_diff> containing the FULL file content with line numbers. \nLines prefixed with 'Line X: +' or 'Line X: -' are the changes.\nLines prefixed with 'Line X: ' (with a space after the colon) are context lines.\n\n**REVIEW GUIDELINES:**\n1. **Focus:** Review ONLY the changes in <git_diff>. Use context lines to understand variable types and logic flow.\n2. **Threshold:** Only report issues with **Score >= 2**. Ignore trivial nits.\n3. **Summary:** Provide a single sentence summary of the overall changes at the beginning.\n4. **LGTM:** If the code is high quality and has no issues, output only "LGTM".\n\n**SCORING:**\n- [Score: 5] Critical (Security, Crash).\n- [Score: 4] Major (Logic, Performance).\n- [Score: 3] Moderate (Maintainability).\n- [Score: 2] Minor (Optimization).\n\n**OUTPUT FORMAT:**\n<Summary sentence>\n\n---\nFile: <file_path>\nContext: <EXACT COPY of the line from the diff starting with "Line X:">\nStartLine: <number>\nEndLine: <number>\nComment: [Score: <2-5>] <Detailed feedback in ${e}>\n---\n`}t.system_prompt_numbered=system_prompt_numbered;function take_system_prompt(e,t){switch(e){case"old":return system_prompt_old(t.toLowerCase()==="chinese");case"numbered":return system_prompt_numbered(t);default:return system_prompt_main(t)}}t.take_system_prompt=take_system_prompt},6087:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.parseAIReviewResponse=t.get=t.post=t.doesAnyPatternMatch=t.split_message=void 0;const n=r(s(8611));const o=r(s(5692));function split_message(e){e=e||"";let t=e.includes("\n")||e.includes("\r");e=e.trim();let s=[];if(e){if(t){s=e.split(/[\r\n]/)}else{s=e.split(",")}}return s.map((e=>e.trim())).filter((e=>e!==null&&e!==undefined&&e!==""))}t.split_message=split_message;function doesAnyPatternMatch(e,t){return e.some((e=>{const s=new RegExp(e);return s.test(t)}))}t.doesAnyPatternMatch=doesAnyPatternMatch;async function post({url:e,body:t,header:s,json:r}){return new Promise(((i,a)=>{r=typeof r==="boolean"?r:true;const l=typeof t==="string"?t:JSON.stringify(t);let c=new URL(e);s=s||{};s["Content-Type"]=s["Content-Type"]||"application/json";s["Content-Length"]=Buffer.byteLength(l);const u={hostname:c.hostname,port:c.port||(c.protocol==="http:"?80:443),path:c.pathname+(c.search||""),method:"POST",headers:s};console.log(`[DEBUG] Sending POST request to: ${e}`);const d=(c.protocol==="http:"?n.default:o.default).request(u,(e=>{console.log(`[DEBUG] Response received. Status Code: ${e.statusCode}`);let t="";const s=e.headers["content-type"];let n="utf-8";if(s){const e=s.match(/charset=([\w-]+)/i);if(e){if(e[1].toLowerCase()==="utf-8"){n="utf-8"}else if(e[1].toLowerCase()==="gbk"){n="ascii"}else if(e[1].toLowerCase()==="ascii"){n="ascii"}else{n="utf-8"}}}e.setEncoding(n);e.on("data",(e=>{t+=e}));e.on("end",(()=>{if(e.statusCode&&e.statusCode>=400){a(new Error(`Request failed with status ${e.statusCode}: ${t}`));return}try{if(r){if(!t.trim()){a(new Error("Received empty response body"));return}i(JSON.parse(t))}else{i(t)}}catch(e){a(new Error("Failed to parse : '"+t+"'"+" with error: "+e.message))}}))}));d.on("error",(e=>{a(new Error(`Request failed: ${e.message}`))}));d.write(l);d.end()}))}t.post=post;async function get(e,t){const s=e.startsWith("https")?o.default:n.default;return new Promise(((r,n)=>{const o=s.get(e,{headers:t},(e=>{let t="";e.on("data",(e=>t+=e));e.on("end",(()=>{try{r(JSON.parse(t))}catch(e){n(e)}}))}));o.on("error",(e=>n(e)))}))}t.get=get;function parseAIReviewResponse(e){let t=e.replace(/<think>[\s\S]*?<\/think>/gi,"").trim();t=t.replace(/(^|\n)\s*LGTM\s*$/i,"").trim();const s=t.split(/^-{3,}\s*$/gm);let r="";const n=[];for(const e of s){const t=e.trim();if(!t)continue;const s=/^(?:File|文件|FilePath)\s*[:：]/im.test(t);const o=/^(?:Comment|Review|评论|注释|反馈)\s*[:：]/im.test(t);if(s&&o){const e=t.match(/^(?:File|文件|FilePath)\s*[:：]\s*(.*)$/im);const s=t.match(/^(?:StartLine|Start\s*Line|起始行号|开始行号|Start)\s*[:：]\s*(\d+)$/im);const r=t.match(/^(?:(?:End)?Line|End\s*Line|结束行号|终止行号|End)\s*[:：]\s*(\d+)$/im);const o=t.match(/^(?:Comment|Review|评论|注释|反馈)\s*[:：]\s*([\s\S]*)$/im);if(e&&r&&o){const t=parseInt(r[1],10);const i=s?parseInt(s[1],10):t;n.push({path:e[1].trim(),line:t,start_line:i!==t?i:undefined,body:o[1].trim()})}}else{if(!t.startsWith("File:")){if(r)r+="\n\n"+t;else r=t}}}return{body:r.trim(),comments:n}}t.parseAIReviewResponse=parseAIReviewResponse},8611:e=>{e.exports=require("http")},5692:e=>{e.exports=require("https")},1421:e=>{e.exports=require("node:child_process")},8013:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.MalformedJSON=t.PartialJSON=t.partialParse=void 0;const s=1;const r=2;const n=4;const o=8;const i=16;const a=32;const l=64;const c=128;const u=256;const d=c|u;const h=i|a|d|l;const p=s|r|h;const f=n|o;const m=p|f;const _={STR:s,NUM:r,ARR:n,OBJ:o,NULL:i,BOOL:a,NAN:l,INFINITY:c,MINUS_INFINITY:u,INF:d,SPECIAL:h,ATOM:p,COLLECTION:f,ALL:m};class PartialJSON extends Error{}t.PartialJSON=PartialJSON;class MalformedJSON extends Error{}t.MalformedJSON=MalformedJSON;function parseJSON(e,t=_.ALL){if(typeof e!=="string"){throw new TypeError(`expecting str, got ${typeof e}`)}if(!e.trim()){throw new Error(`${e} is empty`)}return _parseJSON(e.trim(),t)}const _parseJSON=(e,t)=>{const s=e.length;let r=0;const markPartialJSON=e=>{throw new PartialJSON(`${e} at position ${r}`)};const throwMalformedError=e=>{throw new MalformedJSON(`${e} at position ${r}`)};const parseAny=()=>{skipBlank();if(r>=s)markPartialJSON("Unexpected end of input");if(e[r]==='"')return parseStr();if(e[r]==="{")return parseObj();if(e[r]==="[")return parseArr();if(e.substring(r,r+4)==="null"||_.NULL&t&&s-r<4&&"null".startsWith(e.substring(r))){r+=4;return null}if(e.substring(r,r+4)==="true"||_.BOOL&t&&s-r<4&&"true".startsWith(e.substring(r))){r+=4;return true}if(e.substring(r,r+5)==="false"||_.BOOL&t&&s-r<5&&"false".startsWith(e.substring(r))){r+=5;return false}if(e.substring(r,r+8)==="Infinity"||_.INFINITY&t&&s-r<8&&"Infinity".startsWith(e.substring(r))){r+=8;return Infinity}if(e.substring(r,r+9)==="-Infinity"||_.MINUS_INFINITY&t&&1<s-r&&s-r<9&&"-Infinity".startsWith(e.substring(r))){r+=9;return-Infinity}if(e.substring(r,r+3)==="NaN"||_.NAN&t&&s-r<3&&"NaN".startsWith(e.substring(r))){r+=3;return NaN}return parseNum()};const parseStr=()=>{const n=r;let o=false;r++;while(r<s&&(e[r]!=='"'||o&&e[r-1]==="\\")){o=e[r]==="\\"?!o:false;r++}if(e.charAt(r)=='"'){try{return JSON.parse(e.substring(n,++r-Number(o)))}catch(e){throwMalformedError(String(e))}}else if(_.STR&t){try{return JSON.parse(e.substring(n,r-Number(o))+'"')}catch(t){return JSON.parse(e.substring(n,e.lastIndexOf("\\"))+'"')}}markPartialJSON("Unterminated string literal")};const parseObj=()=>{r++;skipBlank();const n={};try{while(e[r]!=="}"){skipBlank();if(r>=s&&_.OBJ&t)return n;const o=parseStr();skipBlank();r++;try{const e=parseAny();Object.defineProperty(n,o,{value:e,writable:true,enumerable:true,configurable:true})}catch(e){if(_.OBJ&t)return n;else throw e}skipBlank();if(e[r]===",")r++}}catch(e){if(_.OBJ&t)return n;else markPartialJSON("Expected '}' at end of object")}r++;return n};const parseArr=()=>{r++;const s=[];try{while(e[r]!=="]"){s.push(parseAny());skipBlank();if(e[r]===","){r++}}}catch(e){if(_.ARR&t){return s}markPartialJSON("Expected ']' at end of array")}r++;return s};const parseNum=()=>{if(r===0){if(e==="-"&&_.NUM&t)markPartialJSON("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(_.NUM&t){try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}}throwMalformedError(String(s))}}const n=r;if(e[r]==="-")r++;while(e[r]&&!",]}".includes(e[r]))r++;if(r==s&&!(_.NUM&t))markPartialJSON("Unterminated number literal");try{return JSON.parse(e.substring(n,r))}catch(s){if(e.substring(n,r)==="-"&&_.NUM&t)markPartialJSON("Not sure what '-' is");try{return JSON.parse(e.substring(n,e.lastIndexOf("e")))}catch(e){throwMalformedError(String(e))}}};const skipBlank=()=>{while(r<s&&" \n\r\t".includes(e[r])){r++}};return parseAny()};const partialParse=e=>parseJSON(e,_.ALL^_.NUM);t.partialParse=partialParse},7598:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.AzureOpenAI=void 0;const r=s(6411);const n=s(3773);const o=r.__importStar(s(9171));const i=s(4294);const a=s(4522);class AzureOpenAI extends a.OpenAI{constructor({baseURL:e=(0,i.readEnv)("OPENAI_BASE_URL"),apiKey:t=(0,i.readEnv)("AZURE_OPENAI_API_KEY"),apiVersion:s=(0,i.readEnv)("OPENAI_API_VERSION"),endpoint:r,deployment:n,azureADTokenProvider:a,dangerouslyAllowBrowser:l,...c}={}){if(!s){throw new o.OpenAIError("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).")}if(typeof a==="function"){l=true}if(!a&&!t){throw new o.OpenAIError("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.")}if(a&&t){throw new o.OpenAIError("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.")}c.defaultQuery={...c.defaultQuery,"api-version":s};if(!e){if(!r){r=process.env["AZURE_OPENAI_ENDPOINT"]}if(!r){throw new o.OpenAIError("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable")}e=`${r}/openai`}else{if(r){throw new o.OpenAIError("baseURL and endpoint are mutually exclusive")}}super({apiKey:a??t,baseURL:e,...c,...l!==undefined?{dangerouslyAllowBrowser:l}:{}});this.apiVersion="";this.apiVersion=s;this.deploymentName=n}async buildRequest(e,t={}){if(l.has(e.path)&&e.method==="post"&&e.body!==undefined){if(!(0,i.isObj)(e.body)){throw new Error("Expected request body to be an object")}const t=this.deploymentName||e.body["model"]||e.__metadata?.["model"];if(t!==undefined&&!this.baseURL.includes("/deployments")){e.path=`/deployments/${t}${e.path}`}}return super.buildRequest(e,t)}async authHeaders(e){if(typeof this._options.apiKey==="string"){return(0,n.buildHeaders)([{"api-key":this.apiKey}])}return super.authHeaders(e)}}t.AzureOpenAI=AzureOpenAI;const l=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/batches","/images/edits"])},4522:(e,t,s)=>{var r,n,o,i;Object.defineProperty(t,"__esModule",{value:true});t.OpenAI=void 0;const a=s(6411);const l=s(4706);const c=s(8363);const u=s(1226);const d=s(4612);const h=s(5678);const p=a.__importStar(s(3233));const f=a.__importStar(s(1829));const m=a.__importStar(s(4864));const _=s(2177);const g=a.__importStar(s(2575));const b=a.__importStar(s(5049));const y=a.__importStar(s(4199));const v=a.__importStar(s(47));const P=s(5917);const w=s(1663);const A=s(2752);const I=s(6009);const S=s(3048);const O=s(6297);const R=s(521);const E=s(9478);const C=s(907);const F=s(221);const x=s(748);const T=s(4282);const k=s(4066);const j=s(7402);const M=s(3124);const $=s(9528);const N=s(3444);const L=s(392);const G=s(5736);const U=s(1772);const D=s(4560);const q=s(5324);const B=s(5678);const H=s(3773);const W=s(4922);const V=s(443);const J=s(8363);class OpenAI{constructor({baseURL:e=(0,W.readEnv)("OPENAI_BASE_URL"),apiKey:t=(0,W.readEnv)("OPENAI_API_KEY"),organization:s=(0,W.readEnv)("OPENAI_ORG_ID")??null,project:i=(0,W.readEnv)("OPENAI_PROJECT_ID")??null,webhookSecret:l=(0,W.readEnv)("OPENAI_WEBHOOK_SECRET")??null,...c}={}){r.add(this);o.set(this,void 0);this.completions=new v.Completions(this);this.chat=new v.Chat(this);this.embeddings=new v.Embeddings(this);this.files=new v.Files(this);this.images=new v.Images(this);this.audio=new v.Audio(this);this.moderations=new v.Moderations(this);this.models=new v.Models(this);this.fineTuning=new v.FineTuning(this);this.graders=new v.Graders(this);this.vectorStores=new v.VectorStores(this);this.webhooks=new v.Webhooks(this);this.beta=new v.Beta(this);this.batches=new v.Batches(this);this.uploads=new v.Uploads(this);this.responses=new v.Responses(this);this.realtime=new v.Realtime(this);this.conversations=new v.Conversations(this);this.evals=new v.Evals(this);this.containers=new v.Containers(this);this.videos=new v.Videos(this);if(t===undefined){throw new g.OpenAIError("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.")}const u={apiKey:t,organization:s,project:i,webhookSecret:l,...c,baseURL:e||`https://api.openai.com/v1`};if(!u.dangerouslyAllowBrowser&&(0,B.isRunningInBrowser)()){throw new g.OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n")}this.baseURL=u.baseURL;this.timeout=u.timeout??n.DEFAULT_TIMEOUT;this.logger=u.logger??console;const d="warn";this.logLevel=d;this.logLevel=(0,V.parseLogLevel)(u.logLevel,"ClientOptions.logLevel",this)??(0,V.parseLogLevel)((0,W.readEnv)("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??d;this.fetchOptions=u.fetchOptions;this.maxRetries=u.maxRetries??2;this.fetch=u.fetch??p.getDefaultFetch();a.__classPrivateFieldSet(this,o,f.FallbackEncoder,"f");this._options=u;this.apiKey=typeof t==="string"?t:"Missing Key";this.organization=s;this.project=i;this.webhookSecret=l}withOptions(e){const t=new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e});return t}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){return}async authHeaders(e){return(0,H.buildHeaders)([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return m.stringify(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${_.VERSION}`}defaultIdempotencyKey(){return`stainless-node-retry-${(0,l.uuid4)()}`}makeStatusError(e,t,s,r){return g.APIError.generate(e,t,s,r)}async _callApiKey(){const e=this._options.apiKey;if(typeof e!=="function")return false;let t;try{t=await e()}catch(e){if(e instanceof g.OpenAIError)throw e;throw new g.OpenAIError(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if(typeof t!=="string"||!t){throw new g.OpenAIError(`Expected 'apiKey' function argument to return a string but it returned ${t}`)}this.apiKey=t;return true}buildURL(e,t,s){const n=!a.__classPrivateFieldGet(this,r,"m",i).call(this)&&s||this.baseURL;const o=(0,c.isAbsoluteURL)(e)?new URL(e):new URL(n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e));const l=this.defaultQuery();if(!(0,J.isEmptyObj)(l)){t={...l,...t}}if(typeof t==="object"&&t&&!Array.isArray(t)){o.search=this.stringifyQuery(t)}return o.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then((s=>({method:e,path:t,...s}))))}request(e,t=null){return new P.APIPromise(this,this.makeRequest(e,t,undefined))}async makeRequest(e,t,s){const r=await e;const n=r.maxRetries??this.maxRetries;if(t==null){t=n}await this.prepareOptions(r);const{req:o,url:i,timeout:a}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(o,{url:i,options:r});const l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0");const u=s===undefined?"":`, retryOf: ${s}`;const h=Date.now();(0,V.loggerFor)(this).debug(`[${l}] sending request`,(0,V.formatRequestDetails)({retryOfRequestLogID:s,method:r.method,url:i,options:r,headers:o.headers}));if(r.signal?.aborted){throw new g.APIUserAbortError}const f=new AbortController;const m=await this.fetchWithTimeout(i,o,a,f).catch(d.castToError);const _=Date.now();if(m instanceof globalThis.Error){const e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted){throw new g.APIUserAbortError}const n=(0,d.isAbortError)(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(t){(0,V.loggerFor)(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`);(0,V.loggerFor)(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,(0,V.formatRequestDetails)({retryOfRequestLogID:s,url:i,durationMs:_-h,message:m.message}));return this.retryRequest(r,t,s??l)}(0,V.loggerFor)(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`);(0,V.loggerFor)(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,(0,V.formatRequestDetails)({retryOfRequestLogID:s,url:i,durationMs:_-h,message:m.message}));if(n){throw new g.APIConnectionTimeoutError}throw new g.APIConnectionError({cause:m})}const b=[...m.headers.entries()].filter((([e])=>e==="x-request-id")).map((([e,t])=>", "+e+": "+JSON.stringify(t))).join("");const y=`[${l}${u}${b}] ${o.method} ${i} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${_-h}ms`;if(!m.ok){const e=await this.shouldRetry(m);if(t&&e){const e=`retrying, ${t} attempts remaining`;await p.CancelReadableStream(m.body);(0,V.loggerFor)(this).info(`${y} - ${e}`);(0,V.loggerFor)(this).debug(`[${l}] response error (${e})`,(0,V.formatRequestDetails)({retryOfRequestLogID:s,url:m.url,status:m.status,headers:m.headers,durationMs:_-h}));return this.retryRequest(r,t,s??l,m.headers)}const n=e?`error; no more retries left`:`error; not retryable`;(0,V.loggerFor)(this).info(`${y} - ${n}`);const o=await m.text().catch((e=>(0,d.castToError)(e).message));const i=(0,c.safeJSON)(o);const a=i?undefined:o;(0,V.loggerFor)(this).debug(`[${l}] response error (${n})`,(0,V.formatRequestDetails)({retryOfRequestLogID:s,url:m.url,status:m.status,headers:m.headers,message:a,durationMs:Date.now()-h}));const u=this.makeStatusError(m.status,i,a,m.headers);throw u}(0,V.loggerFor)(this).info(y);(0,V.loggerFor)(this).debug(`[${l}] response start`,(0,V.formatRequestDetails)({retryOfRequestLogID:s,url:m.url,status:m.status,headers:m.headers,durationMs:_-h}));return{response:m,options:r,controller:f,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,s&&"then"in s?s.then((t=>({method:"get",path:e,...t}))):{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,undefined);return new b.PagePromise(this,s,e)}async fetchWithTimeout(e,t,s,r){const{signal:n,method:o,...i}=t||{};const a=this._makeAbort(r);if(n)n.addEventListener("abort",a,{once:true});const l=setTimeout(a,s);const c=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||typeof i.body==="object"&&i.body!==null&&Symbol.asyncIterator in i.body;const u={signal:r.signal,...c?{duplex:"half"}:{},method:"GET",...i};if(o){u.method=o.toUpperCase()}try{return await this.fetch.call(undefined,e,u)}finally{clearTimeout(l)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");if(t==="true")return true;if(t==="false")return false;if(e.status===408)return true;if(e.status===409)return true;if(e.status===429)return true;if(e.status>=500)return true;return false}async retryRequest(e,t,s,r){let n;const o=r?.get("retry-after-ms");if(o){const e=parseFloat(o);if(!Number.isNaN(e)){n=e}}const i=r?.get("retry-after");if(i&&!n){const e=parseFloat(i);if(!Number.isNaN(e)){n=e*1e3}else{n=Date.parse(i)-Date.now()}}if(!(n&&0<=n&&n<60*1e3)){const s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}await(0,u.sleep)(n);return this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const s=.5;const r=8;const n=t-e;const o=Math.min(s*Math.pow(2,n),r);const i=1-Math.random()*.25;return o*i*1e3}async buildRequest(e,{retryCount:t=0}={}){const s={...e};const{method:r,path:n,query:o,defaultBaseURL:i}=s;const a=this.buildURL(n,o,i);if("timeout"in s)(0,c.validatePositiveInteger)("timeout",s.timeout);s.timeout=s.timeout??this.timeout;const{bodyHeaders:l,body:u}=this.buildBody({options:s});const d=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});const h={method:r,headers:d,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&u instanceof globalThis.ReadableStream&&{duplex:"half"},...u&&{body:u},...this.fetchOptions??{},...s.fetchOptions??{}};return{req:h,url:a,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let n={};if(this.idempotencyHeader&&t!=="get"){if(!e.idempotencyKey)e.idempotencyKey=this.defaultIdempotencyKey();n[this.idempotencyHeader]=e.idempotencyKey}const o=(0,H.buildHeaders)([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...(0,h.getPlatformHeaders)(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);this.validateHeaders(o);return o.values}_makeAbort(e){return()=>e.abort()}buildBody({options:{body:e,headers:t}}){if(!e){return{bodyHeaders:undefined,body:undefined}}const s=(0,H.buildHeaders)([t]);if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e==="string"&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream){return{bodyHeaders:undefined,body:e}}else if(typeof e==="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next==="function")){return{bodyHeaders:undefined,body:p.ReadableStreamFrom(e)}}else{return a.__classPrivateFieldGet(this,o,"f").call(this,{body:e,headers:s})}}}t.OpenAI=OpenAI;n=OpenAI,o=new WeakMap,r=new WeakSet,i=function _OpenAI_baseURLOverridden(){return this.baseURL!=="https://api.openai.com/v1"};OpenAI.OpenAI=n;OpenAI.DEFAULT_TIMEOUT=6e5;OpenAI.OpenAIError=g.OpenAIError;OpenAI.APIError=g.APIError;OpenAI.APIConnectionError=g.APIConnectionError;OpenAI.APIConnectionTimeoutError=g.APIConnectionTimeoutError;OpenAI.APIUserAbortError=g.APIUserAbortError;OpenAI.NotFoundError=g.NotFoundError;OpenAI.ConflictError=g.ConflictError;OpenAI.RateLimitError=g.RateLimitError;OpenAI.BadRequestError=g.BadRequestError;OpenAI.AuthenticationError=g.AuthenticationError;OpenAI.InternalServerError=g.InternalServerError;OpenAI.PermissionDeniedError=g.PermissionDeniedError;OpenAI.UnprocessableEntityError=g.UnprocessableEntityError;OpenAI.InvalidWebhookSignatureError=g.InvalidWebhookSignatureError;OpenAI.toFile=y.toFile;OpenAI.Completions=A.Completions;OpenAI.Chat=k.Chat;OpenAI.Embeddings=I.Embeddings;OpenAI.Files=S.Files;OpenAI.Images=O.Images;OpenAI.Audio=x.Audio;OpenAI.Moderations=E.Moderations;OpenAI.Models=R.Models;OpenAI.FineTuning=N.FineTuning;OpenAI.Graders=L.Graders;OpenAI.VectorStores=q.VectorStores;OpenAI.Webhooks=F.Webhooks;OpenAI.Beta=T.Beta;OpenAI.Batches=w.Batches;OpenAI.Uploads=D.Uploads;OpenAI.Responses=U.Responses;OpenAI.Realtime=G.Realtime;OpenAI.Conversations=M.Conversations;OpenAI.Evals=$.Evals;OpenAI.Containers=j.Containers;OpenAI.Videos=C.Videos},5917:(e,t,s)=>{var r;Object.defineProperty(t,"__esModule",{value:true});t.APIPromise=void 0;const n=s(6411);const o=s(564);class APIPromise extends Promise{constructor(e,t,s=o.defaultParseResponse){super((e=>{e(null)}));this.responsePromise=t;this.parseResponse=s;r.set(this,void 0);n.__classPrivateFieldSet(this,r,e,"f")}_thenUnwrap(e){return new APIPromise(n.__classPrivateFieldGet(this,r,"f"),this.responsePromise,(async(t,s)=>(0,o.addRequestID)(e(await this.parseResponse(t,s),s),s.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){if(!this.parsedPromise){this.parsedPromise=this.responsePromise.then((e=>this.parseResponse(n.__classPrivateFieldGet(this,r,"f"),e)))}return this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}t.APIPromise=APIPromise;r=new WeakMap},2575:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.InvalidWebhookSignatureError=t.ContentFilterFinishReasonError=t.LengthFinishReasonError=t.InternalServerError=t.RateLimitError=t.UnprocessableEntityError=t.ConflictError=t.NotFoundError=t.PermissionDeniedError=t.AuthenticationError=t.BadRequestError=t.APIConnectionTimeoutError=t.APIConnectionError=t.APIUserAbortError=t.APIError=t.OpenAIError=void 0;const r=s(4612);class OpenAIError extends Error{}t.OpenAIError=OpenAIError;class APIError extends OpenAIError{constructor(e,t,s,r){super(`${APIError.makeMessage(e,t,s)}`);this.status=e;this.headers=r;this.requestID=r?.get("x-request-id");this.error=t;const n=t;this.code=n?.["code"];this.param=n?.["param"];this.type=n?.["type"]}static makeMessage(e,t,s){const r=t?.message?typeof t.message==="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;if(e&&r){return`${e} ${r}`}if(e){return`${e} status code (no body)`}if(r){return r}return"(no status code or body)"}static generate(e,t,s,n){if(!e||!n){return new APIConnectionError({message:s,cause:(0,r.castToError)(t)})}const o=t?.["error"];if(e===400){return new BadRequestError(e,o,s,n)}if(e===401){return new AuthenticationError(e,o,s,n)}if(e===403){return new PermissionDeniedError(e,o,s,n)}if(e===404){return new NotFoundError(e,o,s,n)}if(e===409){return new ConflictError(e,o,s,n)}if(e===422){return new UnprocessableEntityError(e,o,s,n)}if(e===429){return new RateLimitError(e,o,s,n)}if(e>=500){return new InternalServerError(e,o,s,n)}return new APIError(e,o,s,n)}}t.APIError=APIError;class APIUserAbortError extends APIError{constructor({message:e}={}){super(undefined,undefined,e||"Request was aborted.",undefined)}}t.APIUserAbortError=APIUserAbortError;class APIConnectionError extends APIError{constructor({message:e,cause:t}){super(undefined,undefined,e||"Connection error.",undefined);if(t)this.cause=t}}t.APIConnectionError=APIConnectionError;class APIConnectionTimeoutError extends APIConnectionError{constructor({message:e}={}){super({message:e??"Request timed out."})}}t.APIConnectionTimeoutError=APIConnectionTimeoutError;class BadRequestError extends APIError{}t.BadRequestError=BadRequestError;class AuthenticationError extends APIError{}t.AuthenticationError=AuthenticationError;class PermissionDeniedError extends APIError{}t.PermissionDeniedError=PermissionDeniedError;class NotFoundError extends APIError{}t.NotFoundError=NotFoundError;class ConflictError extends APIError{}t.ConflictError=ConflictError;class UnprocessableEntityError extends APIError{}t.UnprocessableEntityError=UnprocessableEntityError;class RateLimitError extends APIError{}t.RateLimitError=RateLimitError;class InternalServerError extends APIError{}t.InternalServerError=InternalServerError;class LengthFinishReasonError extends OpenAIError{constructor(){super(`Could not parse response content as the length limit was reached`)}}t.LengthFinishReasonError=LengthFinishReasonError;class ContentFilterFinishReasonError extends OpenAIError{constructor(){super(`Could not parse response content as the request was rejected by the content filter`)}}t.ContentFilterFinishReasonError=ContentFilterFinishReasonError;class InvalidWebhookSignatureError extends Error{constructor(e){super(e)}}t.InvalidWebhookSignatureError=InvalidWebhookSignatureError},5049:(e,t,s)=>{var r;Object.defineProperty(t,"__esModule",{value:true});t.ConversationCursorPage=t.CursorPage=t.Page=t.PagePromise=t.AbstractPage=void 0;const n=s(6411);const o=s(2575);const i=s(564);const a=s(5917);const l=s(8363);class AbstractPage{constructor(e,t,s,o){r.set(this,void 0);n.__classPrivateFieldSet(this,r,e,"f");this.options=o;this.response=t;this.body=s}hasNextPage(){const e=this.getPaginatedItems();if(!e.length)return false;return this.nextPageRequestOptions()!=null}async getNextPage(){const e=this.nextPageRequestOptions();if(!e){throw new o.OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.")}return await n.__classPrivateFieldGet(this,r,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;yield e;while(e.hasNextPage()){e=await e.getNextPage();yield e}}async*[(r=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages()){for(const t of e.getPaginatedItems()){yield t}}}}t.AbstractPage=AbstractPage;class PagePromise extends a.APIPromise{constructor(e,t,s){super(e,t,(async(e,t)=>new s(e,t.response,await(0,i.defaultParseResponse)(e,t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e){yield t}}}t.PagePromise=PagePromise;class Page extends AbstractPage{constructor(e,t,s,r){super(e,t,s,r);this.data=s.data||[];this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}t.Page=Page;class CursorPage extends AbstractPage{constructor(e,t,s,r){super(e,t,s,r);this.data=s.data||[];this.has_more=s.has_more||false}getPaginatedItems(){return this.data??[]}hasNextPage(){if(this.has_more===false){return false}return super.hasNextPage()}nextPageRequestOptions(){const e=this.getPaginatedItems();const t=e[e.length-1]?.id;if(!t){return null}return{...this.options,query:{...(0,l.maybeObj)(this.options.query),after:t}}}}t.CursorPage=CursorPage;class ConversationCursorPage extends AbstractPage{constructor(e,t,s,r){super(e,t,s,r);this.data=s.data||[];this.has_more=s.has_more||false;this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){if(this.has_more===false){return false}return super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;if(!e){return null}return{...this.options,query:{...(0,l.maybeObj)(this.options.query),after:e}}}}t.ConversationCursorPage=ConversationCursorPage},4945:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.APIResource=void 0;class APIResource{constructor(e){this._client=e}}t.APIResource=APIResource},3173:(e,t,s)=>{var r;Object.defineProperty(t,"__esModule",{value:true});t.Stream=void 0;t._iterSSEMessages=_iterSSEMessages;const n=s(6411);const o=s(2575);const i=s(3233);const a=s(9399);const l=s(3233);const c=s(4612);const u=s(5150);const d=s(443);const h=s(2575);class Stream{constructor(e,t,s){this.iterator=e;r.set(this,void 0);this.controller=t;n.__classPrivateFieldSet(this,r,s,"f")}static fromSSEResponse(e,t,s){let r=false;const n=s?(0,d.loggerFor)(s):console;async function*iterator(){if(r){throw new o.OpenAIError("Cannot iterate over a consumed stream, use `.tee()` to split the stream.")}r=true;let s=false;try{for await(const r of _iterSSEMessages(e,t)){if(s)continue;if(r.data.startsWith("[DONE]")){s=true;continue}if(r.event===null||!r.event.startsWith("thread.")){let t;try{t=JSON.parse(r.data)}catch(e){n.error(`Could not parse message into JSON:`,r.data);n.error(`From chunk:`,r.raw);throw e}if(t&&t.error){throw new h.APIError(undefined,t.error,undefined,e.headers)}yield t}else{let e;try{e=JSON.parse(r.data)}catch(e){console.error(`Could not parse message into JSON:`,r.data);console.error(`From chunk:`,r.raw);throw e}if(r.event=="error"){throw new h.APIError(undefined,e.error,e.message,undefined)}yield{event:r.event,data:e}}}s=true}catch(e){if((0,c.isAbortError)(e))return;throw e}finally{if(!s)t.abort()}}return new Stream(iterator,t,s)}static fromReadableStream(e,t,s){let r=false;async function*iterLines(){const t=new a.LineDecoder;const s=(0,l.ReadableStreamToAsyncIterable)(e);for await(const e of s){for(const s of t.decode(e)){yield s}}for(const e of t.flush()){yield e}}async function*iterator(){if(r){throw new o.OpenAIError("Cannot iterate over a consumed stream, use `.tee()` to split the stream.")}r=true;let e=false;try{for await(const t of iterLines()){if(e)continue;if(t)yield JSON.parse(t)}e=true}catch(e){if((0,c.isAbortError)(e))return;throw e}finally{if(!e)t.abort()}}return new Stream(iterator,t,s)}[(r=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[];const t=[];const s=this.iterator();const teeIterator=r=>({next:()=>{if(r.length===0){const r=s.next();e.push(r);t.push(r)}return r.shift()}});return[new Stream((()=>teeIterator(e)),this.controller,n.__classPrivateFieldGet(this,r,"f")),new Stream((()=>teeIterator(t)),this.controller,n.__classPrivateFieldGet(this,r,"f"))]}toReadableStream(){const e=this;let t;return(0,i.makeReadableStream)({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:s,done:r}=await t.next();if(r)return e.close();const n=(0,u.encodeUTF8)(JSON.stringify(s)+"\n");e.enqueue(n)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}t.Stream=Stream;async function*_iterSSEMessages(e,t){if(!e.body){t.abort();if(typeof globalThis.navigator!=="undefined"&&globalThis.navigator.product==="ReactNative"){throw new o.OpenAIError(`The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api`)}throw new o.OpenAIError(`Attempted to iterate over a response with no body`)}const s=new SSEDecoder;const r=new a.LineDecoder;const n=(0,l.ReadableStreamToAsyncIterable)(e.body);for await(const e of iterSSEChunks(n)){for(const t of r.decode(e)){const e=s.decode(t);if(e)yield e}}for(const e of r.flush()){const t=s.decode(e);if(t)yield t}}async function*iterSSEChunks(e){let t=new Uint8Array;for await(const s of e){if(s==null){continue}const e=s instanceof ArrayBuffer?new Uint8Array(s):typeof s==="string"?(0,u.encodeUTF8)(s):s;let r=new Uint8Array(t.length+e.length);r.set(t);r.set(e,t.length);t=r;let n;while((n=(0,a.findDoubleNewlineIndex)(t))!==-1){yield t.slice(0,n);t=t.slice(n)}}if(t.length>0){yield t}}class SSEDecoder{constructor(){this.event=null;this.data=[];this.chunks=[]}decode(e){if(e.endsWith("\r")){e=e.substring(0,e.length-1)}if(!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};this.event=null;this.data=[];this.chunks=[];return e}this.chunks.push(e);if(e.startsWith(":")){return null}let[t,s,r]=partition(e,":");if(r.startsWith(" ")){r=r.substring(1)}if(t==="event"){this.event=r}else if(t==="data"){this.data.push(r)}return null}}function partition(e,t){const s=e.indexOf(t);if(s!==-1){return[e.substring(0,s),t,e.substring(s+t.length)]}return[e,"",""]}},4199:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.toFile=void 0;var r=s(2301);Object.defineProperty(t,"toFile",{enumerable:true,get:function(){return r.toFile}})},9171:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});const r=s(6411);r.__exportStar(s(2575),t)},9633:(e,t,s)=>{t=e.exports=function(...e){return new t.default(...e)};Object.defineProperty(t,"__esModule",{value:true});t.AzureOpenAI=t.InvalidWebhookSignatureError=t.UnprocessableEntityError=t.PermissionDeniedError=t.InternalServerError=t.AuthenticationError=t.BadRequestError=t.RateLimitError=t.ConflictError=t.NotFoundError=t.APIUserAbortError=t.APIConnectionTimeoutError=t.APIConnectionError=t.APIError=t.OpenAIError=t.PagePromise=t.OpenAI=t.APIPromise=t.toFile=t["default"]=void 0;var r=s(4522);Object.defineProperty(t,"default",{enumerable:true,get:function(){return r.OpenAI}});var n=s(4199);Object.defineProperty(t,"toFile",{enumerable:true,get:function(){return n.toFile}});var o=s(5917);Object.defineProperty(t,"APIPromise",{enumerable:true,get:function(){return o.APIPromise}});var i=s(4522);Object.defineProperty(t,"OpenAI",{enumerable:true,get:function(){return i.OpenAI}});var a=s(5049);Object.defineProperty(t,"PagePromise",{enumerable:true,get:function(){return a.PagePromise}});var l=s(2575);Object.defineProperty(t,"OpenAIError",{enumerable:true,get:function(){return l.OpenAIError}});Object.defineProperty(t,"APIError",{enumerable:true,get:function(){return l.APIError}});Object.defineProperty(t,"APIConnectionError",{enumerable:true,get:function(){return l.APIConnectionError}});Object.defineProperty(t,"APIConnectionTimeoutError",{enumerable:true,get:function(){return l.APIConnectionTimeoutError}});Object.defineProperty(t,"APIUserAbortError",{enumerable:true,get:function(){return l.APIUserAbortError}});Object.defineProperty(t,"NotFoundError",{enumerable:true,get:function(){return l.NotFoundError}});Object.defineProperty(t,"ConflictError",{enumerable:true,get:function(){return l.ConflictError}});Object.defineProperty(t,"RateLimitError",{enumerable:true,get:function(){return l.RateLimitError}});Object.defineProperty(t,"BadRequestError",{enumerable:true,get:function(){return l.BadRequestError}});Object.defineProperty(t,"AuthenticationError",{enumerable:true,get:function(){return l.AuthenticationError}});Object.defineProperty(t,"InternalServerError",{enumerable:true,get:function(){return l.InternalServerError}});Object.defineProperty(t,"PermissionDeniedError",{enumerable:true,get:function(){return l.PermissionDeniedError}});Object.defineProperty(t,"UnprocessableEntityError",{enumerable:true,get:function(){return l.UnprocessableEntityError}});Object.defineProperty(t,"InvalidWebhookSignatureError",{enumerable:true,get:function(){return l.InvalidWebhookSignatureError}});var c=s(7598);Object.defineProperty(t,"AzureOpenAI",{enumerable:true,get:function(){return c.AzureOpenAI}})},9399:(e,t,s)=>{var r,n;Object.defineProperty(t,"__esModule",{value:true});t.LineDecoder=void 0;t.findDoubleNewlineIndex=findDoubleNewlineIndex;const o=s(6411);const i=s(5150);class LineDecoder{constructor(){r.set(this,void 0);n.set(this,void 0);o.__classPrivateFieldSet(this,r,new Uint8Array,"f");o.__classPrivateFieldSet(this,n,null,"f")}decode(e){if(e==null){return[]}const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e==="string"?(0,i.encodeUTF8)(e):e;o.__classPrivateFieldSet(this,r,(0,i.concatBytes)([o.__classPrivateFieldGet(this,r,"f"),t]),"f");const s=[];let a;while((a=findNewlineIndex(o.__classPrivateFieldGet(this,r,"f"),o.__classPrivateFieldGet(this,n,"f")))!=null){if(a.carriage&&o.__classPrivateFieldGet(this,n,"f")==null){o.__classPrivateFieldSet(this,n,a.index,"f");continue}if(o.__classPrivateFieldGet(this,n,"f")!=null&&(a.index!==o.__classPrivateFieldGet(this,n,"f")+1||a.carriage)){s.push((0,i.decodeUTF8)(o.__classPrivateFieldGet(this,r,"f").subarray(0,o.__classPrivateFieldGet(this,n,"f")-1)));o.__classPrivateFieldSet(this,r,o.__classPrivateFieldGet(this,r,"f").subarray(o.__classPrivateFieldGet(this,n,"f")),"f");o.__classPrivateFieldSet(this,n,null,"f");continue}const e=o.__classPrivateFieldGet(this,n,"f")!==null?a.preceding-1:a.preceding;const t=(0,i.decodeUTF8)(o.__classPrivateFieldGet(this,r,"f").subarray(0,e));s.push(t);o.__classPrivateFieldSet(this,r,o.__classPrivateFieldGet(this,r,"f").subarray(a.index),"f");o.__classPrivateFieldSet(this,n,null,"f")}return s}flush(){if(!o.__classPrivateFieldGet(this,r,"f").length){return[]}return this.decode("\n")}}t.LineDecoder=LineDecoder;r=new WeakMap,n=new WeakMap;LineDecoder.NEWLINE_CHARS=new Set(["\n","\r"]);LineDecoder.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function findNewlineIndex(e,t){const s=10;const r=13;for(let n=t??0;n<e.length;n++){if(e[n]===s){return{preceding:n,index:n+1,carriage:false}}if(e[n]===r){return{preceding:n,index:n+1,carriage:true}}}return null}function findDoubleNewlineIndex(e){const t=10;const s=13;for(let r=0;r<e.length-1;r++){if(e[r]===t&&e[r+1]===t){return r+2}if(e[r]===s&&e[r+1]===s){return r+2}if(e[r]===s&&e[r+1]===t&&r+3<e.length&&e[r+2]===s&&e[r+3]===t){return r+4}}return-1}},5678:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.getPlatformHeaders=t.isRunningInBrowser=void 0;const r=s(2177);const isRunningInBrowser=()=>typeof window!=="undefined"&&typeof window.document!=="undefined"&&typeof navigator!=="undefined";t.isRunningInBrowser=isRunningInBrowser;function getDetectedPlatform(){if(typeof Deno!=="undefined"&&Deno.build!=null){return"deno"}if(typeof EdgeRuntime!=="undefined"){return"edge"}if(Object.prototype.toString.call(typeof globalThis.process!=="undefined"?globalThis.process:0)==="[object process]"){return"node"}return"unknown"}const getPlatformProperties=()=>{const e=getDetectedPlatform();if(e==="deno"){return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":r.VERSION,"X-Stainless-OS":normalizePlatform(Deno.build.os),"X-Stainless-Arch":normalizeArch(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version==="string"?Deno.version:Deno.version?.deno??"unknown"}}if(typeof EdgeRuntime!=="undefined"){return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":r.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version}}if(e==="node"){return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":r.VERSION,"X-Stainless-OS":normalizePlatform(globalThis.process.platform??"unknown"),"X-Stainless-Arch":normalizeArch(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"}}const t=getBrowserInfo();if(t){return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":r.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}}return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":r.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function getBrowserInfo(){if(typeof navigator==="undefined"||!navigator){return null}const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e){const s=e[1]||0;const r=e[2]||0;const n=e[3]||0;return{browser:t,version:`${s}.${r}.${n}`}}}return null}const normalizeArch=e=>{if(e==="x32")return"x32";if(e==="x86_64"||e==="x64")return"x64";if(e==="arm")return"arm";if(e==="aarch64"||e==="arm64")return"arm64";if(e)return`other:${e}`;return"unknown"};const normalizePlatform=e=>{e=e.toLowerCase();if(e.includes("ios"))return"iOS";if(e==="android")return"Android";if(e==="darwin")return"MacOS";if(e==="win32")return"Windows";if(e==="freebsd")return"FreeBSD";if(e==="openbsd")return"OpenBSD";if(e==="linux")return"Linux";if(e)return`Other:${e}`;return"Unknown"};let n;const getPlatformHeaders=()=>n??(n=getPlatformProperties());t.getPlatformHeaders=getPlatformHeaders},4612:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.castToError=void 0;t.isAbortError=isAbortError;function isAbortError(e){return typeof e==="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const castToError=e=>{if(e instanceof Error)return e;if(typeof e==="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});if(e.stack)t.stack=e.stack;if(e.cause&&!t.cause)t.cause=e.cause;if(e.name)t.name=e.name;return t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};t.castToError=castToError},3773:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.isEmptyHeaders=t.buildHeaders=void 0;const r=s(8363);const n=Symbol("brand.privateNullableHeaders");function*iterateHeaders(e){if(!e)return;if(n in e){const{values:t,nulls:s}=e;yield*t.entries();for(const e of s){yield[e,null]}return}let t=false;let s;if(e instanceof Headers){s=e.entries()}else if((0,r.isReadonlyArray)(e)){s=e}else{t=true;s=Object.entries(e??{})}for(let e of s){const s=e[0];if(typeof s!=="string")throw new TypeError("expected header name to be a string");const n=(0,r.isReadonlyArray)(e[1])?e[1]:[e[1]];let o=false;for(const e of n){if(e===undefined)continue;if(t&&!o){o=true;yield[s,null]}yield[s,e]}}}const buildHeaders=e=>{const t=new Headers;const s=new Set;for(const r of e){const e=new Set;for(const[n,o]of iterateHeaders(r)){const r=n.toLowerCase();if(!e.has(r)){t.delete(n);e.add(r)}if(o===null){t.delete(n);s.add(r)}else{t.append(n,o);s.delete(r)}}}return{[n]:true,values:t,nulls:s}};t.buildHeaders=buildHeaders;const isEmptyHeaders=e=>{for(const t of iterateHeaders(e))return false;return true};t.isEmptyHeaders=isEmptyHeaders},564:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.defaultParseResponse=defaultParseResponse;t.addRequestID=addRequestID;const r=s(3173);const n=s(443);async function defaultParseResponse(e,t){const{response:s,requestLogID:o,retryOfRequestLogID:i,startTime:a}=t;const l=await(async()=>{if(t.options.stream){(0,n.loggerFor)(e).debug("response",s.status,s.url,s.headers,s.body);if(t.options.__streamClass){return t.options.__streamClass.fromSSEResponse(s,t.controller,e)}return r.Stream.fromSSEResponse(s,t.controller,e)}if(s.status===204){return null}if(t.options.__binaryResponse){return s}const o=s.headers.get("content-type");const i=o?.split(";")[0]?.trim();const a=i?.includes("application/json")||i?.endsWith("+json");if(a){const e=s.headers.get("content-length");if(e==="0"){return undefined}const t=await s.json();return addRequestID(t,s)}const l=await s.text();return l})();(0,n.loggerFor)(e).debug(`[${o}] response parsed`,(0,n.formatRequestDetails)({retryOfRequestLogID:i,url:s.url,status:s.status,body:l,durationMs:Date.now()-a}));return l}function addRequestID(e,t){if(!e||typeof e!=="object"||Array.isArray(e)){return e}return Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:false})}},8976:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.RFC3986=t.RFC1738=t.formatters=t.default_formatter=t.default_format=void 0;t.default_format="RFC3986";const default_formatter=e=>String(e);t.default_formatter=default_formatter;t.formatters={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:t.default_formatter};t.RFC1738="RFC1738";t.RFC3986="RFC3986"},4864:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.formats=t.stringify=void 0;const r=s(8976);const n={formatters:r.formatters,RFC1738:r.RFC1738,RFC3986:r.RFC3986,default:r.default_format};t.formats=n;var o=s(5389);Object.defineProperty(t,"stringify",{enumerable:true,get:function(){return o.stringify}})},5389:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.stringify=stringify;const r=s(6201);const n=s(8976);const o=s(8363);const i={brackets(e){return String(e)+"[]"},comma:"comma",indices(e,t){return String(e)+"["+t+"]"},repeat(e){return String(e)}};const push_to_array=function(e,t){Array.prototype.push.apply(e,(0,o.isArray)(t)?t:[t])};let a;const l={addQueryPrefix:false,allowDots:false,allowEmptyArrays:false,arrayFormat:"indices",charset:"utf-8",charsetSentinel:false,delimiter:"&",encode:true,encodeDotInKeys:false,encoder:r.encode,encodeValuesOnly:false,format:n.default_format,formatter:n.default_formatter,indices:false,serializeDate(e){return(a??(a=Function.prototype.call.bind(Date.prototype.toISOString)))(e)},skipNulls:false,strictNullHandling:false};function is_non_nullish_primitive(e){return typeof e==="string"||typeof e==="number"||typeof e==="boolean"||typeof e==="symbol"||typeof e==="bigint"}const c={};function inner_stringify(e,t,s,n,i,a,u,d,h,p,f,m,_,g,b,y,v,P){let w=e;let A=P;let I=0;let S=false;while((A=A.get(c))!==void undefined&&!S){const t=A.get(e);I+=1;if(typeof t!=="undefined"){if(t===I){throw new RangeError("Cyclic object value")}else{S=true}}if(typeof A.get(c)==="undefined"){I=0}}if(typeof p==="function"){w=p(t,w)}else if(w instanceof Date){w=_?.(w)}else if(s==="comma"&&(0,o.isArray)(w)){w=(0,r.maybe_map)(w,(function(e){if(e instanceof Date){return _?.(e)}return e}))}if(w===null){if(a){return h&&!y?h(t,l.encoder,v,"key",g):t}w=""}if(is_non_nullish_primitive(w)||(0,r.is_buffer)(w)){if(h){const e=y?t:h(t,l.encoder,v,"key",g);return[b?.(e)+"="+b?.(h(w,l.encoder,v,"value",g))]}return[b?.(t)+"="+b?.(String(w))]}const O=[];if(typeof w==="undefined"){return O}let R;if(s==="comma"&&(0,o.isArray)(w)){if(y&&h){w=(0,r.maybe_map)(w,h)}R=[{value:w.length>0?w.join(",")||null:void undefined}]}else if((0,o.isArray)(p)){R=p}else{const e=Object.keys(w);R=f?e.sort(f):e}const E=d?String(t).replace(/\./g,"%2E"):String(t);const C=n&&(0,o.isArray)(w)&&w.length===1?E+"[]":E;if(i&&(0,o.isArray)(w)&&w.length===0){return C+"[]"}for(let t=0;t<R.length;++t){const r=R[t];const l=typeof r==="object"&&typeof r.value!=="undefined"?r.value:w[r];if(u&&l===null){continue}const A=m&&d?r.replace(/\./g,"%2E"):r;const S=(0,o.isArray)(w)?typeof s==="function"?s(C,A):C:C+(m?"."+A:"["+A+"]");P.set(e,I);const E=new WeakMap;E.set(c,P);push_to_array(O,inner_stringify(l,S,s,n,i,a,u,d,s==="comma"&&y&&(0,o.isArray)(w)?null:h,p,f,m,_,g,b,y,v,E))}return O}function normalize_stringify_options(e=l){if(typeof e.allowEmptyArrays!=="undefined"&&typeof e.allowEmptyArrays!=="boolean"){throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided")}if(typeof e.encodeDotInKeys!=="undefined"&&typeof e.encodeDotInKeys!=="boolean"){throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided")}if(e.encoder!==null&&typeof e.encoder!=="undefined"&&typeof e.encoder!=="function"){throw new TypeError("Encoder has to be a function.")}const t=e.charset||l.charset;if(typeof e.charset!=="undefined"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1"){throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined")}let s=n.default_format;if(typeof e.format!=="undefined"){if(!(0,r.has)(n.formatters,e.format)){throw new TypeError("Unknown format option provided.")}s=e.format}const a=n.formatters[s];let c=l.filter;if(typeof e.filter==="function"||(0,o.isArray)(e.filter)){c=e.filter}let u;if(e.arrayFormat&&e.arrayFormat in i){u=e.arrayFormat}else if("indices"in e){u=e.indices?"indices":"repeat"}else{u=l.arrayFormat}if("commaRoundTrip"in e&&typeof e.commaRoundTrip!=="boolean"){throw new TypeError("`commaRoundTrip` must be a boolean, or absent")}const d=typeof e.allowDots==="undefined"?!!e.encodeDotInKeys===true?true:l.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix==="boolean"?e.addQueryPrefix:l.addQueryPrefix,allowDots:d,allowEmptyArrays:typeof e.allowEmptyArrays==="boolean"?!!e.allowEmptyArrays:l.allowEmptyArrays,arrayFormat:u,charset:t,charsetSentinel:typeof e.charsetSentinel==="boolean"?e.charsetSentinel:l.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter==="undefined"?l.delimiter:e.delimiter,encode:typeof e.encode==="boolean"?e.encode:l.encode,encodeDotInKeys:typeof e.encodeDotInKeys==="boolean"?e.encodeDotInKeys:l.encodeDotInKeys,encoder:typeof e.encoder==="function"?e.encoder:l.encoder,encodeValuesOnly:typeof e.encodeValuesOnly==="boolean"?e.encodeValuesOnly:l.encodeValuesOnly,filter:c,format:s,formatter:a,serializeDate:typeof e.serializeDate==="function"?e.serializeDate:l.serializeDate,skipNulls:typeof e.skipNulls==="boolean"?e.skipNulls:l.skipNulls,sort:typeof e.sort==="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling==="boolean"?e.strictNullHandling:l.strictNullHandling}}function stringify(e,t={}){let s=e;const r=normalize_stringify_options(t);let n;let a;if(typeof r.filter==="function"){a=r.filter;s=a("",s)}else if((0,o.isArray)(r.filter)){a=r.filter;n=a}const l=[];if(typeof s!=="object"||s===null){return""}const c=i[r.arrayFormat];const u=c==="comma"&&r.commaRoundTrip;if(!n){n=Object.keys(s)}if(r.sort){n.sort(r.sort)}const d=new WeakMap;for(let e=0;e<n.length;++e){const t=n[e];if(r.skipNulls&&s[t]===null){continue}push_to_array(l,inner_stringify(s[t],t,c,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,d))}const h=l.join(r.delimiter);let p=r.addQueryPrefix===true?"?":"";if(r.charsetSentinel){if(r.charset==="iso-8859-1"){p+="utf8=%26%2310003%3B&"}else{p+="utf8=%E2%9C%93&"}}return h.length>0?p+h:""}},6201:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.encode=t.has=void 0;t.merge=merge;t.assign_single_source=assign_single_source;t.decode=decode;t.compact=compact;t.is_regexp=is_regexp;t.is_buffer=is_buffer;t.combine=combine;t.maybe_map=maybe_map;const r=s(8976);const n=s(8363);let has=(e,s)=>(t.has=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),(0,t.has)(e,s));t.has=has;const o=(()=>{const e=[];for(let t=0;t<256;++t){e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase())}return e})();function compact_queue(e){while(e.length>1){const t=e.pop();if(!t)continue;const s=t.obj[t.prop];if((0,n.isArray)(s)){const e=[];for(let t=0;t<s.length;++t){if(typeof s[t]!=="undefined"){e.push(s[t])}}t.obj[t.prop]=e}}}function array_to_object(e,t){const s=t&&t.plainObjects?Object.create(null):{};for(let t=0;t<e.length;++t){if(typeof e[t]!=="undefined"){s[t]=e[t]}}return s}function merge(e,s,r={}){if(!s){return e}if(typeof s!=="object"){if((0,n.isArray)(e)){e.push(s)}else if(e&&typeof e==="object"){if(r&&(r.plainObjects||r.allowPrototypes)||!(0,t.has)(Object.prototype,s)){e[s]=true}}else{return[e,s]}return e}if(!e||typeof e!=="object"){return[e].concat(s)}let o=e;if((0,n.isArray)(e)&&!(0,n.isArray)(s)){o=array_to_object(e,r)}if((0,n.isArray)(e)&&(0,n.isArray)(s)){s.forEach((function(s,n){if((0,t.has)(e,n)){const t=e[n];if(t&&typeof t==="object"&&s&&typeof s==="object"){e[n]=merge(t,s,r)}else{e.push(s)}}else{e[n]=s}}));return e}return Object.keys(s).reduce((function(e,n){const o=s[n];if((0,t.has)(e,n)){e[n]=merge(e[n],o,r)}else{e[n]=o}return e}),o)}function assign_single_source(e,t){return Object.keys(t).reduce((function(e,s){e[s]=t[s];return e}),e)}function decode(e,t,s){const r=e.replace(/\+/g," ");if(s==="iso-8859-1"){return r.replace(/%[0-9a-f]{2}/gi,unescape)}try{return decodeURIComponent(r)}catch(e){return r}}const i=1024;const encode=(e,t,s,n,a)=>{if(e.length===0){return e}let l=e;if(typeof e==="symbol"){l=Symbol.prototype.toString.call(e)}else if(typeof e!=="string"){l=String(e)}if(s==="iso-8859-1"){return escape(l).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}))}let c="";for(let e=0;e<l.length;e+=i){const t=l.length>=i?l.slice(e,e+i):l;const s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(n===45||n===46||n===95||n===126||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||a===r.RFC1738&&(n===40||n===41)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=o[n];continue}if(n<2048){s[s.length]=o[192|n>>6]+o[128|n&63];continue}if(n<55296||n>=57344){s[s.length]=o[224|n>>12]+o[128|n>>6&63]+o[128|n&63];continue}e+=1;n=65536+((n&1023)<<10|t.charCodeAt(e)&1023);s[s.length]=o[240|n>>18]+o[128|n>>12&63]+o[128|n>>6&63]+o[128|n&63]}c+=s.join("")}return c};t.encode=encode;function compact(e){const t=[{obj:{o:e},prop:"o"}];const s=[];for(let e=0;e<t.length;++e){const r=t[e];const n=r.obj[r.prop];const o=Object.keys(n);for(let e=0;e<o.length;++e){const r=o[e];const i=n[r];if(typeof i==="object"&&i!==null&&s.indexOf(i)===-1){t.push({obj:n,prop:r});s.push(i)}}}compact_queue(t);return e}function is_regexp(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function is_buffer(e){if(!e||typeof e!=="object"){return false}return!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function combine(e,t){return[].concat(e,t)}function maybe_map(e,t){if((0,n.isArray)(e)){const s=[];for(let r=0;r<e.length;r+=1){s.push(t(e[r]))}return s}return t(e)}},1829:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.FallbackEncoder=void 0;const FallbackEncoder=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});t.FallbackEncoder=FallbackEncoder},3233:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.getDefaultFetch=getDefaultFetch;t.makeReadableStream=makeReadableStream;t.ReadableStreamFrom=ReadableStreamFrom;t.ReadableStreamToAsyncIterable=ReadableStreamToAsyncIterable;t.CancelReadableStream=CancelReadableStream;function getDefaultFetch(){if(typeof fetch!=="undefined"){return fetch}throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function makeReadableStream(...e){const t=globalThis.ReadableStream;if(typeof t==="undefined"){throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`")}return new t(...e)}function ReadableStreamFrom(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return makeReadableStream({start(){},async pull(e){const{done:s,value:r}=await t.next();if(s){e.close()}else{e.enqueue(r)}},async cancel(){await(t.return?.())}})}function ReadableStreamToAsyncIterable(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();if(e?.done)t.releaseLock();return e}catch(e){t.releaseLock();throw e}},async return(){const e=t.cancel();t.releaseLock();await e;return{done:true,value:undefined}},[Symbol.asyncIterator](){return this}}}async function CancelReadableStream(e){if(e===null||typeof e!=="object")return;if(e[Symbol.asyncIterator]){await(e[Symbol.asyncIterator]().return?.());return}const t=e.getReader();const s=t.cancel();t.releaseLock();await s}},2301:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.toFile=toFile;const r=s(8561);const n=s(8561);const isBlobLike=e=>e!=null&&typeof e==="object"&&typeof e.size==="number"&&typeof e.type==="string"&&typeof e.text==="function"&&typeof e.slice==="function"&&typeof e.arrayBuffer==="function";const isFileLike=e=>e!=null&&typeof e==="object"&&typeof e.name==="string"&&typeof e.lastModified==="number"&&isBlobLike(e);const isResponseLike=e=>e!=null&&typeof e==="object"&&typeof e.url==="string"&&typeof e.blob==="function";async function toFile(e,t,s){(0,n.checkFileSupport)();e=await e;if(isFileLike(e)){if(e instanceof File){return e}return(0,r.makeFile)([await e.arrayBuffer()],e.name)}if(isResponseLike(e)){const n=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop());return(0,r.makeFile)(await getBytes(n),t,s)}const o=await getBytes(e);t||(t=(0,r.getName)(e));if(!s?.type){const e=o.find((e=>typeof e==="object"&&"type"in e&&e.type));if(typeof e==="string"){s={...s,type:e}}}return(0,r.makeFile)(o,t,s)}async function getBytes(e){let t=[];if(typeof e==="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer){t.push(e)}else if(isBlobLike(e)){t.push(e instanceof Blob?e:await e.arrayBuffer())}else if((0,r.isAsyncIterable)(e)){for await(const s of e){t.push(...await getBytes(s))}}else{const t=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${propsForError(e)}`)}return t}function propsForError(e){if(typeof e!=="object"||e===null)return"";const t=Object.getOwnPropertyNames(e);return`; props: [${t.map((e=>`"${e}"`)).join(", ")}]`}},6411:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.__setModuleDefault=t.__createBinding=void 0;t.__classPrivateFieldSet=__classPrivateFieldSet;t.__classPrivateFieldGet=__classPrivateFieldGet;t.__exportStar=__exportStar;t.__importStar=__importStar;function __classPrivateFieldSet(e,t,s,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof t==="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(e,s):n?n.value=s:t.set(e,s),s}function __classPrivateFieldGet(e,t,s,r){if(s==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t==="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?r:s==="a"?r.call(e):r?r.value:t.get(e)}var s=Object.create?function(e,t,s,r){if(r===void 0)r=s;var n=Object.getOwnPropertyDescriptor(t,s);if(!n||("get"in n?!t.__esModule:n.writable||n.configurable)){n={enumerable:true,get:function(){return t[s]}}}Object.defineProperty(e,r,n)}:function(e,t,s,r){if(r===void 0)r=s;e[r]=t[s]};t.__createBinding=s;function __exportStar(e,t){for(var r in e)if(r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r))s(t,e,r)}var r=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t};t.__setModuleDefault=r;var ownKeys=function(e){ownKeys=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s))t[t.length]=s;return t};return ownKeys(e)};function __importStar(e){if(e&&e.__esModule)return e;var t={};if(e!=null){for(var n=ownKeys(e),o=0;o<n.length;o++)if(n[o]!=="default")s(t,e,n[o])}r(t,e);return t}},8561:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.createForm=t.multipartFormRequestOptions=t.maybeMultipartFormRequestOptions=t.isAsyncIterable=t.checkFileSupport=void 0;t.makeFile=makeFile;t.getName=getName;const r=s(3233);const checkFileSupport=()=>{if(typeof File==="undefined"){const{process:e}=globalThis;const t=typeof e?.versions?.node==="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};t.checkFileSupport=checkFileSupport;function makeFile(e,s,r){(0,t.checkFileSupport)();return new File(e,s??"unknown_file",r)}function getName(e){return(typeof e==="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||undefined}const isAsyncIterable=e=>e!=null&&typeof e==="object"&&typeof e[Symbol.asyncIterator]==="function";t.isAsyncIterable=isAsyncIterable;const maybeMultipartFormRequestOptions=async(e,s)=>{if(!hasUploadableValue(e.body))return e;return{...e,body:await(0,t.createForm)(e.body,s)}};t.maybeMultipartFormRequestOptions=maybeMultipartFormRequestOptions;const multipartFormRequestOptions=async(e,s)=>({...e,body:await(0,t.createForm)(e.body,s)});t.multipartFormRequestOptions=multipartFormRequestOptions;const n=new WeakMap;function supportsFormData(e){const t=typeof e==="function"?e:e.fetch;const s=n.get(t);if(s)return s;const r=(async()=>{try{const e="Response"in t?t.Response:(await t("data:,")).constructor;const s=new FormData;if(s.toString()===await new e(s).text()){return false}return true}catch{return true}})();n.set(t,r);return r}const createForm=async(e,t)=>{if(!await supportsFormData(t)){throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.")}const s=new FormData;await Promise.all(Object.entries(e||{}).map((([e,t])=>addFormValue(s,e,t))));return s};t.createForm=createForm;const isNamedBlob=e=>e instanceof Blob&&"name"in e;const isUploadable=e=>typeof e==="object"&&e!==null&&(e instanceof Response||(0,t.isAsyncIterable)(e)||isNamedBlob(e));const hasUploadableValue=e=>{if(isUploadable(e))return true;if(Array.isArray(e))return e.some(hasUploadableValue);if(e&&typeof e==="object"){for(const t in e){if(hasUploadableValue(e[t]))return true}}return false};const addFormValue=async(e,s,n)=>{if(n===undefined)return;if(n==null){throw new TypeError(`Received null for "${s}"; to pass null in FormData, you must use the string 'null'`)}if(typeof n==="string"||typeof n==="number"||typeof n==="boolean"){e.append(s,String(n))}else if(n instanceof Response){e.append(s,makeFile([await n.blob()],getName(n)))}else if((0,t.isAsyncIterable)(n)){e.append(s,makeFile([await new Response((0,r.ReadableStreamFrom)(n)).blob()],getName(n)))}else if(isNamedBlob(n)){e.append(s,n,getName(n))}else if(Array.isArray(n)){await Promise.all(n.map((t=>addFormValue(e,s+"[]",t))))}else if(typeof n==="object"){await Promise.all(Object.entries(n).map((([t,r])=>addFormValue(e,`${s}[${t}]`,r))))}else{throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}}},4294:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});const r=s(6411);r.__exportStar(s(8363),t);r.__exportStar(s(8098),t);r.__exportStar(s(4922),t);r.__exportStar(s(443),t);r.__exportStar(s(4706),t);r.__exportStar(s(1226),t)},8098:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.toFloat32Array=t.fromBase64=t.toBase64=void 0;const r=s(2575);const n=s(5150);const toBase64=e=>{if(!e)return"";if(typeof globalThis.Buffer!=="undefined"){return globalThis.Buffer.from(e).toString("base64")}if(typeof e==="string"){e=(0,n.encodeUTF8)(e)}if(typeof btoa!=="undefined"){return btoa(String.fromCharCode.apply(null,e))}throw new r.OpenAIError("Cannot generate base64 string; Expected `Buffer` or `btoa` to be defined")};t.toBase64=toBase64;const fromBase64=e=>{if(typeof globalThis.Buffer!=="undefined"){const t=globalThis.Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}if(typeof atob!=="undefined"){const t=atob(e);const s=new Uint8Array(t.length);for(let e=0;e<t.length;e++){s[e]=t.charCodeAt(e)}return s}throw new r.OpenAIError("Cannot decode base64 string; Expected `Buffer` or `atob` to be defined")};t.fromBase64=fromBase64;const toFloat32Array=e=>{if(typeof Buffer!=="undefined"){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(e);const s=t.length;const r=new Uint8Array(s);for(let e=0;e<s;e++){r[e]=t.charCodeAt(e)}return Array.from(new Float32Array(r.buffer))}};t.toFloat32Array=toFloat32Array},5150:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.concatBytes=concatBytes;t.encodeUTF8=encodeUTF8;t.decodeUTF8=decodeUTF8;function concatBytes(e){let t=0;for(const s of e){t+=s.length}const s=new Uint8Array(t);let r=0;for(const t of e){s.set(t,r);r+=t.length}return s}let s;function encodeUTF8(e){let t;return(s??(t=new globalThis.TextEncoder,s=t.encode.bind(t)))(e)}let r;function decodeUTF8(e){let t;return(r??(t=new globalThis.TextDecoder,r=t.decode.bind(t)))(e)}},4922:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.readEnv=void 0;const readEnv=e=>{if(typeof globalThis.process!=="undefined"){return globalThis.process.env?.[e]?.trim()??undefined}if(typeof globalThis.Deno!=="undefined"){return globalThis.Deno.env?.get?.(e)?.trim()}return undefined};t.readEnv=readEnv},443:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.formatRequestDetails=t.parseLogLevel=void 0;t.loggerFor=loggerFor;const r=s(8363);const n={off:0,error:200,warn:300,info:400,debug:500};const parseLogLevel=(e,t,s)=>{if(!e){return undefined}if((0,r.hasOwn)(n,e)){return e}loggerFor(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(n))}`);return undefined};t.parseLogLevel=parseLogLevel;function noop(){}function makeLogFn(e,t,s){if(!t||n[e]>n[s]){return noop}else{return t[e].bind(t)}}const o={error:noop,warn:noop,info:noop,debug:noop};let i=new WeakMap;function loggerFor(e){const t=e.logger;const s=e.logLevel??"off";if(!t){return o}const r=i.get(t);if(r&&r[0]===s){return r[1]}const n={error:makeLogFn("error",t,s),warn:makeLogFn("warn",t,s),info:makeLogFn("info",t,s),debug:makeLogFn("debug",t,s)};i.set(t,[s,n]);return n}const formatRequestDetails=e=>{if(e.options){e.options={...e.options};delete e.options["headers"]}if(e.headers){e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map((([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t])))}if("retryOfRequestLogID"in e){if(e.retryOfRequestLogID){e.retryOf=e.retryOfRequestLogID}delete e.retryOfRequestLogID}return e};t.formatRequestDetails=formatRequestDetails},574:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.path=t.createPathTagFunction=void 0;t.encodeURIPath=encodeURIPath;const r=s(2575);function encodeURIPath(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const n=Object.freeze(Object.create(null));const createPathTagFunction=(e=encodeURIPath)=>function path(t,...s){if(t.length===1)return t[0];let o=false;const i=[];const path=t.reduce(((t,r,a)=>{if(/[?#]/.test(r)){o=true}const l=s[a];let c=(o?encodeURIComponent:e)(""+l);if(a!==s.length&&(l==null||typeof l==="object"&&l.toString===Object.getPrototypeOf(Object.getPrototypeOf(l.hasOwnProperty??n)??n)?.toString)){c=l+"";i.push({start:t.length+r.length,length:c.length,error:`Value of type ${Object.prototype.toString.call(l).slice(8,-1)} is not a valid path parameter`})}return t+r+(a===s.length?"":c)}),"");const a=path.split(/[?#]/,1)[0];const l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let c;while((c=l.exec(a))!==null){i.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`})}i.sort(((e,t)=>e.start-t.start));if(i.length>0){let e=0;const t=i.reduce(((t,s)=>{const r=" ".repeat(s.start-e);const n="^".repeat(s.length);e=s.start+s.length;return t+r+n}),"");throw new r.OpenAIError(`Path parameters result in path with invalid segments:\n${i.map((e=>e.error)).join("\n")}\n${path}\n${t}`)}return path};t.createPathTagFunction=createPathTagFunction;t.path=(0,t.createPathTagFunction)(encodeURIPath)},1226:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.sleep=void 0;const sleep=e=>new Promise((t=>setTimeout(t,e)));t.sleep=sleep},4706:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.uuid4=void 0;let uuid4=function(){const{crypto:e}=globalThis;if(e?.randomUUID){t.uuid4=e.randomUUID.bind(e);return e.randomUUID()}const s=new Uint8Array(1);const r=e?()=>e.getRandomValues(s)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(+e^r()&15>>+e/4).toString(16)))};t.uuid4=uuid4},8363:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.safeJSON=t.maybeCoerceBoolean=t.maybeCoerceFloat=t.maybeCoerceInteger=t.coerceBoolean=t.coerceFloat=t.coerceInteger=t.validatePositiveInteger=t.ensurePresent=t.isReadonlyArray=t.isArray=t.isAbsoluteURL=void 0;t.maybeObj=maybeObj;t.isEmptyObj=isEmptyObj;t.hasOwn=hasOwn;t.isObj=isObj;const r=s(2575);const n=/^[a-z][a-z0-9+.-]*:/i;const isAbsoluteURL=e=>n.test(e);t.isAbsoluteURL=isAbsoluteURL;let isArray=e=>(t.isArray=Array.isArray,(0,t.isArray)(e));t.isArray=isArray;t.isReadonlyArray=t.isArray;function maybeObj(e){if(typeof e!=="object"){return{}}return e??{}}function isEmptyObj(e){if(!e)return true;for(const t in e)return false;return true}function hasOwn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function isObj(e){return e!=null&&typeof e==="object"&&!Array.isArray(e)}const ensurePresent=e=>{if(e==null){throw new r.OpenAIError(`Expected a value to be given but received ${e} instead.`)}return e};t.ensurePresent=ensurePresent;const validatePositiveInteger=(e,t)=>{if(typeof t!=="number"||!Number.isInteger(t)){throw new r.OpenAIError(`${e} must be an integer`)}if(t<0){throw new r.OpenAIError(`${e} must be a positive integer`)}return t};t.validatePositiveInteger=validatePositiveInteger;const coerceInteger=e=>{if(typeof e==="number")return Math.round(e);if(typeof e==="string")return parseInt(e,10);throw new r.OpenAIError(`Could not coerce ${e} (type: ${typeof e}) into a number`)};t.coerceInteger=coerceInteger;const coerceFloat=e=>{if(typeof e==="number")return e;if(typeof e==="string")return parseFloat(e);throw new r.OpenAIError(`Could not coerce ${e} (type: ${typeof e}) into a number`)};t.coerceFloat=coerceFloat;const coerceBoolean=e=>{if(typeof e==="boolean")return e;if(typeof e==="string")return e==="true";return Boolean(e)};t.coerceBoolean=coerceBoolean;const maybeCoerceInteger=e=>{if(e==null){return undefined}return(0,t.coerceInteger)(e)};t.maybeCoerceInteger=maybeCoerceInteger;const maybeCoerceFloat=e=>{if(e==null){return undefined}return(0,t.coerceFloat)(e)};t.maybeCoerceFloat=maybeCoerceFloat;const maybeCoerceBoolean=e=>{if(e==null){return undefined}return(0,t.coerceBoolean)(e)};t.maybeCoerceBoolean=maybeCoerceBoolean;const safeJSON=e=>{try{return JSON.parse(e)}catch(e){return undefined}};t.safeJSON=safeJSON},8601:(e,t,s)=>{var r,n,o,i,a,l,c,u;Object.defineProperty(t,"__esModule",{value:true});t.AbstractChatCompletionRunner=void 0;const d=s(6411);const h=s(9171);const p=s(230);const f=s(116);const m=s(7977);const _=s(8568);const g=10;class AbstractChatCompletionRunner extends m.EventStream{constructor(){super(...arguments);r.add(this);this._chatCompletions=[];this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e);this._emit("chatCompletion",e);const t=e.choices[0]?.message;if(t)this._addMessage(t);return e}_addMessage(e,t=true){if(!("content"in e))e.content=null;this.messages.push(e);if(t){this._emit("message",e);if((0,f.isToolMessage)(e)&&e.content){this._emit("functionToolCallResult",e.content)}else if((0,f.isAssistantMessage)(e)&&e.tool_calls){for(const t of e.tool_calls){if(t.type==="function"){this._emit("functionToolCall",t.function)}}}}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new h.OpenAIError("stream ended without producing a ChatCompletion");return e}async finalContent(){await this.done();return d.__classPrivateFieldGet(this,r,"m",n).call(this)}async finalMessage(){await this.done();return d.__classPrivateFieldGet(this,r,"m",o).call(this)}async finalFunctionToolCall(){await this.done();return d.__classPrivateFieldGet(this,r,"m",i).call(this)}async finalFunctionToolCallResult(){await this.done();return d.__classPrivateFieldGet(this,r,"m",a).call(this)}async totalUsage(){await this.done();return d.__classPrivateFieldGet(this,r,"m",l).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];if(e)this._emit("finalChatCompletion",e);const t=d.__classPrivateFieldGet(this,r,"m",o).call(this);if(t)this._emit("finalMessage",t);const s=d.__classPrivateFieldGet(this,r,"m",n).call(this);if(s)this._emit("finalContent",s);const c=d.__classPrivateFieldGet(this,r,"m",i).call(this);if(c)this._emit("finalFunctionToolCall",c);const u=d.__classPrivateFieldGet(this,r,"m",a).call(this);if(u!=null)this._emit("finalFunctionToolCallResult",u);if(this._chatCompletions.some((e=>e.usage))){this._emit("totalUsage",d.__classPrivateFieldGet(this,r,"m",l).call(this))}}async _createChatCompletion(e,t,s){const n=s?.signal;if(n){if(n.aborted)this.controller.abort();n.addEventListener("abort",(()=>this.controller.abort()))}d.__classPrivateFieldGet(this,r,"m",c).call(this,t);const o=await e.chat.completions.create({...t,stream:false},{...s,signal:this.controller.signal});this._connected();return this._addChatCompletion((0,p.parseChatCompletion)(o,t))}async _runChatCompletion(e,t,s){for(const e of t.messages){this._addMessage(e,false)}return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){const n="tool";const{tool_choice:o="auto",stream:i,...a}=t;const l=typeof o!=="string"&&o.type==="function"&&o?.function?.name;const{maxChatCompletions:c=g}=s||{};const f=t.tools.map((e=>{if((0,p.isAutoParsableTool)(e)){if(!e.$callback){throw new h.OpenAIError("Tool given to `.runTools()` that does not have an associated function")}return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:true}}}return e}));const m={};for(const e of f){if(e.type==="function"){m[e.function.name||e.function.function.name]=e.function}}const b="tools"in t?f.map((e=>e.type==="function"?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):undefined;for(const e of t.messages){this._addMessage(e,false)}for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...a,tool_choice:o,tools:b,messages:[...this.messages]},s);const i=t.choices[0]?.message;if(!i){throw new h.OpenAIError(`missing message in ChatCompletion response`)}if(!i.tool_calls?.length){return}for(const e of i.tool_calls){if(e.type!=="function")continue;const t=e.id;const{name:s,arguments:o}=e.function;const i=m[s];if(!i){const e=`Invalid tool_call: ${JSON.stringify(s)}. Available options are: ${Object.keys(m).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}else if(l&&l!==s){const e=`Invalid tool_call: ${JSON.stringify(s)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}let a;try{a=(0,_.isRunnableFunctionWithParse)(i)?await i.parse(o):o}catch(e){const s=e instanceof Error?e.message:String(e);this._addMessage({role:n,tool_call_id:t,content:s});continue}const c=await i.function(a,this);const h=d.__classPrivateFieldGet(this,r,"m",u).call(this,c);this._addMessage({role:n,tool_call_id:t,content:h});if(l){return}}}return}}t.AbstractChatCompletionRunner=AbstractChatCompletionRunner;r=new WeakSet,n=function _AbstractChatCompletionRunner_getFinalContent(){return d.__classPrivateFieldGet(this,r,"m",o).call(this).content??null},o=function _AbstractChatCompletionRunner_getFinalMessage(){let e=this.messages.length;while(e-- >0){const t=this.messages[e];if((0,f.isAssistantMessage)(t)){const e={...t,content:t.content??null,refusal:t.refusal??null};return e}}throw new h.OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},i=function _AbstractChatCompletionRunner_getFinalFunctionToolCall(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if((0,f.isAssistantMessage)(t)&&t?.tool_calls?.length){return t.tool_calls.filter((e=>e.type==="function")).at(-1)?.function}}return},a=function _AbstractChatCompletionRunner_getFinalFunctionToolCallResult(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if((0,f.isToolMessage)(t)&&t.content!=null&&typeof t.content==="string"&&this.messages.some((e=>e.role==="assistant"&&e.tool_calls?.some((e=>e.type==="function"&&e.id===t.tool_call_id))))){return t.content}}return},l=function _AbstractChatCompletionRunner_calculateTotalUsage(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions){if(t){e.completion_tokens+=t.completion_tokens;e.prompt_tokens+=t.prompt_tokens;e.total_tokens+=t.total_tokens}}return e},c=function _AbstractChatCompletionRunner_validateParams(e){if(e.n!=null&&e.n>1){throw new h.OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")}},u=function _AbstractChatCompletionRunner_stringifyFunctionCallResult(e){return typeof e==="string"?e:e===undefined?"undefined":JSON.stringify(e)}},6825:(e,t,s)=>{var r,n,o,i,a,l,c,u,d,h,p,f,m,_,g,b,y,v,P,w,A,I,S;Object.defineProperty(t,"__esModule",{value:true});t.AssistantStream=void 0;const O=s(6411);const R=s(9553);const E=s(9171);const C=s(7977);const F=s(4294);class AssistantStream extends C.EventStream{constructor(){super(...arguments);r.add(this);o.set(this,[]);i.set(this,{});a.set(this,{});l.set(this,void 0);c.set(this,void 0);u.set(this,void 0);d.set(this,void 0);h.set(this,void 0);p.set(this,void 0);f.set(this,void 0);m.set(this,void 0);_.set(this,void 0)}[(o=new WeakMap,i=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,_=new WeakMap,r=new WeakSet,Symbol.asyncIterator)](){const e=[];const t=[];let s=false;this.on("event",(s=>{const r=t.shift();if(r){r.resolve(s)}else{e.push(s)}}));this.on("end",(()=>{s=true;for(const e of t){e.resolve(undefined)}t.length=0}));this.on("abort",(e=>{s=true;for(const s of t){s.reject(e)}t.length=0}));this.on("error",(e=>{s=true;for(const s of t){s.reject(e)}t.length=0}));return{next:async()=>{if(!e.length){if(s){return{value:undefined,done:true}}return new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:false}:{value:undefined,done:true}))}const r=e.shift();return{value:r,done:false}},return:async()=>{this.abort();return{value:undefined,done:true}}}}static fromReadableStream(e){const t=new n;t._run((()=>t._fromReadableStream(e)));return t}async _fromReadableStream(e,t){const s=t?.signal;if(s){if(s.aborted)this.controller.abort();s.addEventListener("abort",(()=>this.controller.abort()))}this._connected();const n=R.Stream.fromReadableStream(e,this.controller);for await(const e of n){O.__classPrivateFieldGet(this,r,"m",g).call(this,e)}if(n.controller.signal?.aborted){throw new E.APIUserAbortError}return this._addRun(O.__classPrivateFieldGet(this,r,"m",b).call(this))}toReadableStream(){const e=new R.Stream(this[Symbol.asyncIterator].bind(this),this.controller);return e.toReadableStream()}static createToolAssistantStream(e,t,s,r){const o=new n;o._run((()=>o._runToolAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})));return o}async _createToolAssistantStream(e,t,s,n){const o=n?.signal;if(o){if(o.aborted)this.controller.abort();o.addEventListener("abort",(()=>this.controller.abort()))}const i={...s,stream:true};const a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});this._connected();for await(const e of a){O.__classPrivateFieldGet(this,r,"m",g).call(this,e)}if(a.controller.signal?.aborted){throw new E.APIUserAbortError}return this._addRun(O.__classPrivateFieldGet(this,r,"m",b).call(this))}static createThreadAssistantStream(e,t,s){const r=new n;r._run((()=>r._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})));return r}static createAssistantStream(e,t,s,r){const o=new n;o._run((()=>o._runAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})));return o}currentEvent(){return O.__classPrivateFieldGet(this,f,"f")}currentRun(){return O.__classPrivateFieldGet(this,m,"f")}currentMessageSnapshot(){return O.__classPrivateFieldGet(this,l,"f")}currentRunStepSnapshot(){return O.__classPrivateFieldGet(this,_,"f")}async finalRunSteps(){await this.done();return Object.values(O.__classPrivateFieldGet(this,i,"f"))}async finalMessages(){await this.done();return Object.values(O.__classPrivateFieldGet(this,a,"f"))}async finalRun(){await this.done();if(!O.__classPrivateFieldGet(this,c,"f"))throw Error("Final run was not received.");return O.__classPrivateFieldGet(this,c,"f")}async _createThreadAssistantStream(e,t,s){const n=s?.signal;if(n){if(n.aborted)this.controller.abort();n.addEventListener("abort",(()=>this.controller.abort()))}const o={...t,stream:true};const i=await e.createAndRun(o,{...s,signal:this.controller.signal});this._connected();for await(const e of i){O.__classPrivateFieldGet(this,r,"m",g).call(this,e)}if(i.controller.signal?.aborted){throw new E.APIUserAbortError}return this._addRun(O.__classPrivateFieldGet(this,r,"m",b).call(this))}async _createAssistantStream(e,t,s,n){const o=n?.signal;if(o){if(o.aborted)this.controller.abort();o.addEventListener("abort",(()=>this.controller.abort()))}const i={...s,stream:true};const a=await e.create(t,i,{...n,signal:this.controller.signal});this._connected();for await(const e of a){O.__classPrivateFieldGet(this,r,"m",g).call(this,e)}if(a.controller.signal?.aborted){throw new E.APIUserAbortError}return this._addRun(O.__classPrivateFieldGet(this,r,"m",b).call(this))}static accumulateDelta(e,t){for(const[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let t=e[s];if(t===null||t===undefined){e[s]=r;continue}if(s==="index"||s==="type"){e[s]=r;continue}if(typeof t==="string"&&typeof r==="string"){t+=r}else if(typeof t==="number"&&typeof r==="number"){t+=r}else if((0,F.isObj)(t)&&(0,F.isObj)(r)){t=this.accumulateDelta(t,r)}else if(Array.isArray(t)&&Array.isArray(r)){if(t.every((e=>typeof e==="string"||typeof e==="number"))){t.push(...r);continue}for(const e of r){if(!(0,F.isObj)(e)){throw new Error(`Expected array delta entry to be an object but got: ${e}`)}const s=e["index"];if(s==null){console.error(e);throw new Error("Expected array delta entry to have an `index` property")}if(typeof s!=="number"){throw new Error(`Expected array delta entry \`index\` property to be a number but got ${s}`)}const r=t[s];if(r==null){t.push(e)}else{t[s]=this.accumulateDelta(r,e)}}continue}else{throw Error(`Unhandled record type: ${s}, deltaValue: ${r}, accValue: ${t}`)}e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r){return await this._createToolAssistantStream(t,e,s,r)}}t.AssistantStream=AssistantStream;n=AssistantStream,g=function _AssistantStream_addEvent(e){if(this.ended)return;O.__classPrivateFieldSet(this,f,e,"f");O.__classPrivateFieldGet(this,r,"m",P).call(this,e);switch(e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":O.__classPrivateFieldGet(this,r,"m",S).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":O.__classPrivateFieldGet(this,r,"m",v).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":O.__classPrivateFieldGet(this,r,"m",y).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:assertNever(e)}},b=function _AssistantStream_endRequest(){if(this.ended){throw new E.OpenAIError(`stream has ended, this shouldn't happen`)}if(!O.__classPrivateFieldGet(this,c,"f"))throw Error("Final run has not been received");return O.__classPrivateFieldGet(this,c,"f")},y=function _AssistantStream_handleMessage(e){const[t,s]=O.__classPrivateFieldGet(this,r,"m",A).call(this,e,O.__classPrivateFieldGet(this,l,"f"));O.__classPrivateFieldSet(this,l,t,"f");O.__classPrivateFieldGet(this,a,"f")[t.id]=t;for(const e of s){const s=t.content[e.index];if(s?.type=="text"){this._emit("textCreated",s.text)}}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":this._emit("messageDelta",e.data.delta,t);if(e.data.delta.content){for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let e=s.text;let r=t.content[s.index];if(r&&r.type=="text"){this._emit("textDelta",e,r.text)}else{throw Error("The snapshot associated with this text delta is not text or missing")}}if(s.index!=O.__classPrivateFieldGet(this,u,"f")){if(O.__classPrivateFieldGet(this,d,"f")){switch(O.__classPrivateFieldGet(this,d,"f").type){case"text":this._emit("textDone",O.__classPrivateFieldGet(this,d,"f").text,O.__classPrivateFieldGet(this,l,"f"));break;case"image_file":this._emit("imageFileDone",O.__classPrivateFieldGet(this,d,"f").image_file,O.__classPrivateFieldGet(this,l,"f"));break}}O.__classPrivateFieldSet(this,u,s.index,"f")}O.__classPrivateFieldSet(this,d,t.content[s.index],"f")}}break;case"thread.message.completed":case"thread.message.incomplete":if(O.__classPrivateFieldGet(this,u,"f")!==undefined){const t=e.data.content[O.__classPrivateFieldGet(this,u,"f")];if(t){switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,O.__classPrivateFieldGet(this,l,"f"));break;case"text":this._emit("textDone",t.text,O.__classPrivateFieldGet(this,l,"f"));break}}}if(O.__classPrivateFieldGet(this,l,"f")){this._emit("messageDone",e.data)}O.__classPrivateFieldSet(this,l,undefined,"f")}},v=function _AssistantStream_handleRunStep(e){const t=O.__classPrivateFieldGet(this,r,"m",w).call(this,e);O.__classPrivateFieldSet(this,_,t,"f");switch(e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&t.step_details.type=="tool_calls"){for(const e of s.step_details.tool_calls){if(e.index==O.__classPrivateFieldGet(this,h,"f")){this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index])}else{if(O.__classPrivateFieldGet(this,p,"f")){this._emit("toolCallDone",O.__classPrivateFieldGet(this,p,"f"))}O.__classPrivateFieldSet(this,h,e.index,"f");O.__classPrivateFieldSet(this,p,t.step_details.tool_calls[e.index],"f");if(O.__classPrivateFieldGet(this,p,"f"))this._emit("toolCallCreated",O.__classPrivateFieldGet(this,p,"f"))}}}this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":O.__classPrivateFieldSet(this,_,undefined,"f");const r=e.data.step_details;if(r.type=="tool_calls"){if(O.__classPrivateFieldGet(this,p,"f")){this._emit("toolCallDone",O.__classPrivateFieldGet(this,p,"f"));O.__classPrivateFieldSet(this,p,undefined,"f")}}this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},P=function _AssistantStream_handleEvent(e){O.__classPrivateFieldGet(this,o,"f").push(e);this._emit("event",e)},w=function _AssistantStream_accumulateRunStep(e){switch(e.event){case"thread.run.step.created":O.__classPrivateFieldGet(this,i,"f")[e.data.id]=e.data;return e.data;case"thread.run.step.delta":let t=O.__classPrivateFieldGet(this,i,"f")[e.data.id];if(!t){throw Error("Received a RunStepDelta before creation of a snapshot")}let s=e.data;if(s.delta){const r=n.accumulateDelta(t,s.delta);O.__classPrivateFieldGet(this,i,"f")[e.data.id]=r}return O.__classPrivateFieldGet(this,i,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":O.__classPrivateFieldGet(this,i,"f")[e.data.id]=e.data;break}if(O.__classPrivateFieldGet(this,i,"f")[e.data.id])return O.__classPrivateFieldGet(this,i,"f")[e.data.id];throw new Error("No snapshot available")},A=function _AssistantStream_accumulateMessage(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t){throw Error("Received a delta with no existing snapshot (there should be one from message creation)")}let n=e.data;if(n.delta.content){for(const e of n.delta.content){if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=O.__classPrivateFieldGet(this,r,"m",I).call(this,e,s)}else{t.content[e.index]=e;s.push(e)}}}return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t){return[t,s]}else{throw Error("Received thread message event with no existing snapshot")}}throw Error("Tried to accumulate a non-message event")},I=function _AssistantStream_accumulateContent(e,t){return n.accumulateDelta(t,e)},S=function _AssistantStream_handleRun(e){O.__classPrivateFieldSet(this,m,e.data,"f");switch(e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":O.__classPrivateFieldSet(this,c,e.data,"f");if(O.__classPrivateFieldGet(this,p,"f")){this._emit("toolCallDone",O.__classPrivateFieldGet(this,p,"f"));O.__classPrivateFieldSet(this,p,undefined,"f")}break;case"thread.run.cancelling":break}};function assertNever(e){}},5419:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.ChatCompletionRunner=void 0;const r=s(8601);const n=s(116);class ChatCompletionRunner extends r.AbstractChatCompletionRunner{static runTools(e,t,s){const r=new ChatCompletionRunner;const n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};r._run((()=>r._runTools(e,t,n)));return r}_addMessage(e,t=true){super._addMessage(e,t);if((0,n.isAssistantMessage)(e)&&e.content){this._emit("content",e.content)}}}t.ChatCompletionRunner=ChatCompletionRunner},6221:(e,t,s)=>{var r,n,o,i,a,l,c,u,d,h,p,f;Object.defineProperty(t,"__esModule",{value:true});t.ChatCompletionStream=void 0;const m=s(6411);const _=s(8013);const g=s(9171);const b=s(230);const y=s(9553);const v=s(8601);class ChatCompletionStream extends v.AbstractChatCompletionRunner{constructor(e){super();r.add(this);n.set(this,void 0);o.set(this,void 0);i.set(this,void 0);m.__classPrivateFieldSet(this,n,e,"f");m.__classPrivateFieldSet(this,o,[],"f")}get currentChatCompletionSnapshot(){return m.__classPrivateFieldGet(this,i,"f")}static fromReadableStream(e){const t=new ChatCompletionStream(null);t._run((()=>t._fromReadableStream(e)));return t}static createChatCompletion(e,t,s){const r=new ChatCompletionStream(t);r._run((()=>r._runChatCompletion(e,{...t,stream:true},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})));return r}async _createChatCompletion(e,t,s){super._createChatCompletion;const n=s?.signal;if(n){if(n.aborted)this.controller.abort();n.addEventListener("abort",(()=>this.controller.abort()))}m.__classPrivateFieldGet(this,r,"m",a).call(this);const o=await e.chat.completions.create({...t,stream:true},{...s,signal:this.controller.signal});this._connected();for await(const e of o){m.__classPrivateFieldGet(this,r,"m",c).call(this,e)}if(o.controller.signal?.aborted){throw new g.APIUserAbortError}return this._addChatCompletion(m.__classPrivateFieldGet(this,r,"m",h).call(this))}async _fromReadableStream(e,t){const s=t?.signal;if(s){if(s.aborted)this.controller.abort();s.addEventListener("abort",(()=>this.controller.abort()))}m.__classPrivateFieldGet(this,r,"m",a).call(this);this._connected();const n=y.Stream.fromReadableStream(e,this.controller);let o;for await(const e of n){if(o&&o!==e.id){this._addChatCompletion(m.__classPrivateFieldGet(this,r,"m",h).call(this))}m.__classPrivateFieldGet(this,r,"m",c).call(this,e);o=e.id}if(n.controller.signal?.aborted){throw new g.APIUserAbortError}return this._addChatCompletion(m.__classPrivateFieldGet(this,r,"m",h).call(this))}[(n=new WeakMap,o=new WeakMap,i=new WeakMap,r=new WeakSet,a=function _ChatCompletionStream_beginRequest(){if(this.ended)return;m.__classPrivateFieldSet(this,i,undefined,"f")},l=function _ChatCompletionStream_getChoiceEventState(e){let t=m.__classPrivateFieldGet(this,o,"f")[e.index];if(t){return t}t={content_done:false,refusal_done:false,logprobs_content_done:false,logprobs_refusal_done:false,done_tool_calls:new Set,current_tool_call_index:null};m.__classPrivateFieldGet(this,o,"f")[e.index]=t;return t},c=function _ChatCompletionStream_addChunk(e){if(this.ended)return;const t=m.__classPrivateFieldGet(this,r,"m",f).call(this,e);this._emit("chunk",e,t);for(const s of e.choices){const e=t.choices[s.index];if(s.delta.content!=null&&e.message?.role==="assistant"&&e.message?.content){this._emit("content",s.delta.content,e.message.content);this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})}if(s.delta.refusal!=null&&e.message?.role==="assistant"&&e.message?.refusal){this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal})}if(s.logprobs?.content!=null&&e.message?.role==="assistant"){this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]})}if(s.logprobs?.refusal!=null&&e.message?.role==="assistant"){this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]})}const n=m.__classPrivateFieldGet(this,r,"m",l).call(this,e);if(e.finish_reason){m.__classPrivateFieldGet(this,r,"m",d).call(this,e);if(n.current_tool_call_index!=null){m.__classPrivateFieldGet(this,r,"m",u).call(this,e,n.current_tool_call_index)}}for(const t of s.delta.tool_calls??[]){if(n.current_tool_call_index!==t.index){m.__classPrivateFieldGet(this,r,"m",d).call(this,e);if(n.current_tool_call_index!=null){m.__classPrivateFieldGet(this,r,"m",u).call(this,e,n.current_tool_call_index)}}n.current_tool_call_index=t.index}for(const t of s.delta.tool_calls??[]){const s=e.message.tool_calls?.[t.index];if(!s?.type){continue}if(s?.type==="function"){this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""})}else{assertNever(s?.type)}}}},u=function _ChatCompletionStream_emitToolCallDoneEvent(e,t){const s=m.__classPrivateFieldGet(this,r,"m",l).call(this,e);if(s.done_tool_calls.has(t)){return}const o=e.message.tool_calls?.[t];if(!o){throw new Error("no tool call snapshot")}if(!o.type){throw new Error("tool call snapshot missing `type`")}if(o.type==="function"){const e=m.__classPrivateFieldGet(this,n,"f")?.tools?.find((e=>(0,b.isChatCompletionFunctionTool)(e)&&e.function.name===o.function.name));this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:t,arguments:o.function.arguments,parsed_arguments:(0,b.isAutoParsableTool)(e)?e.$parseRaw(o.function.arguments):e?.function.strict?JSON.parse(o.function.arguments):null})}else{assertNever(o.type)}},d=function _ChatCompletionStream_emitContentDoneEvents(e){const t=m.__classPrivateFieldGet(this,r,"m",l).call(this,e);if(e.message.content&&!t.content_done){t.content_done=true;const s=m.__classPrivateFieldGet(this,r,"m",p).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}if(e.message.refusal&&!t.refusal_done){t.refusal_done=true;this._emit("refusal.done",{refusal:e.message.refusal})}if(e.logprobs?.content&&!t.logprobs_content_done){t.logprobs_content_done=true;this._emit("logprobs.content.done",{content:e.logprobs.content})}if(e.logprobs?.refusal&&!t.logprobs_refusal_done){t.logprobs_refusal_done=true;this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal})}},h=function _ChatCompletionStream_endRequest(){if(this.ended){throw new g.OpenAIError(`stream has ended, this shouldn't happen`)}const e=m.__classPrivateFieldGet(this,i,"f");if(!e){throw new g.OpenAIError(`request ended without sending any chunks`)}m.__classPrivateFieldSet(this,i,undefined,"f");m.__classPrivateFieldSet(this,o,[],"f");return finalizeChatCompletion(e,m.__classPrivateFieldGet(this,n,"f"))},p=function _ChatCompletionStream_getAutoParseableResponseFormat(){const e=m.__classPrivateFieldGet(this,n,"f")?.response_format;if((0,b.isAutoParsableResponseFormat)(e)){return e}return null},f=function _ChatCompletionStream_accumulateChatCompletion(e){var t,s,o,a;let l=m.__classPrivateFieldGet(this,i,"f");const{choices:c,...u}=e;if(!l){l=m.__classPrivateFieldSet(this,i,{...u,choices:[]},"f")}else{Object.assign(l,u)}for(const{delta:i,finish_reason:c,index:u,logprobs:d=null,...h}of e.choices){let e=l.choices[u];if(!e){e=l.choices[u]={finish_reason:c,index:u,message:{},logprobs:d,...h}}if(d){if(!e.logprobs){e.logprobs=Object.assign({},d)}else{const{content:r,refusal:n,...o}=d;assertIsEmpty(o);Object.assign(e.logprobs,o);if(r){(t=e.logprobs).content??(t.content=[]);e.logprobs.content.push(...r)}if(n){(s=e.logprobs).refusal??(s.refusal=[]);e.logprobs.refusal.push(...n)}}}if(c){e.finish_reason=c;if(m.__classPrivateFieldGet(this,n,"f")&&(0,b.hasAutoParseableInput)(m.__classPrivateFieldGet(this,n,"f"))){if(c==="length"){throw new g.LengthFinishReasonError}if(c==="content_filter"){throw new g.ContentFilterFinishReasonError}}}Object.assign(e,h);if(!i)continue;const{content:f,refusal:y,function_call:v,role:P,tool_calls:w,...A}=i;assertIsEmpty(A);Object.assign(e.message,A);if(y){e.message.refusal=(e.message.refusal||"")+y}if(P)e.message.role=P;if(v){if(!e.message.function_call){e.message.function_call=v}else{if(v.name)e.message.function_call.name=v.name;if(v.arguments){(o=e.message.function_call).arguments??(o.arguments="");e.message.function_call.arguments+=v.arguments}}}if(f){e.message.content=(e.message.content||"")+f;if(!e.message.refusal&&m.__classPrivateFieldGet(this,r,"m",p).call(this)){e.message.parsed=(0,_.partialParse)(e.message.content)}}if(w){if(!e.message.tool_calls)e.message.tool_calls=[];for(const{index:t,id:s,type:r,function:o,...i}of w){const l=(a=e.message.tool_calls)[t]??(a[t]={});Object.assign(l,i);if(s)l.id=s;if(r)l.type=r;if(o)l.function??(l.function={name:o.name??"",arguments:""});if(o?.name)l.function.name=o.name;if(o?.arguments){l.function.arguments+=o.arguments;if((0,b.shouldParseToolCall)(m.__classPrivateFieldGet(this,n,"f"),l)){l.function.parsed_arguments=(0,_.partialParse)(l.function.arguments)}}}}}return l},Symbol.asyncIterator)](){const e=[];const t=[];let s=false;this.on("chunk",(s=>{const r=t.shift();if(r){r.resolve(s)}else{e.push(s)}}));this.on("end",(()=>{s=true;for(const e of t){e.resolve(undefined)}t.length=0}));this.on("abort",(e=>{s=true;for(const s of t){s.reject(e)}t.length=0}));this.on("error",(e=>{s=true;for(const s of t){s.reject(e)}t.length=0}));return{next:async()=>{if(!e.length){if(s){return{value:undefined,done:true}}return new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:false}:{value:undefined,done:true}))}const r=e.shift();return{value:r,done:false}},return:async()=>{this.abort();return{value:undefined,done:true}}}}toReadableStream(){const e=new y.Stream(this[Symbol.asyncIterator].bind(this),this.controller);return e.toReadableStream()}}t.ChatCompletionStream=ChatCompletionStream;function finalizeChatCompletion(e,t){const{id:s,choices:r,created:n,model:o,system_fingerprint:i,...a}=e;const l={...a,id:s,choices:r.map((({message:t,finish_reason:s,index:r,logprobs:n,...o})=>{if(!s){throw new g.OpenAIError(`missing finish_reason for choice ${r}`)}const{content:i=null,function_call:a,tool_calls:l,...c}=t;const u=t.role;if(!u){throw new g.OpenAIError(`missing role for choice ${r}`)}if(a){const{arguments:e,name:l}=a;if(e==null){throw new g.OpenAIError(`missing function_call.arguments for choice ${r}`)}if(!l){throw new g.OpenAIError(`missing function_call.name for choice ${r}`)}return{...o,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}if(l){return{...o,index:r,finish_reason:s,logprobs:n,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map(((t,s)=>{const{function:n,type:o,id:i,...a}=t;const{arguments:l,name:c,...u}=n||{};if(i==null){throw new g.OpenAIError(`missing choices[${r}].tool_calls[${s}].id\n${str(e)}`)}if(o==null){throw new g.OpenAIError(`missing choices[${r}].tool_calls[${s}].type\n${str(e)}`)}if(c==null){throw new g.OpenAIError(`missing choices[${r}].tool_calls[${s}].function.name\n${str(e)}`)}if(l==null){throw new g.OpenAIError(`missing choices[${r}].tool_calls[${s}].function.arguments\n${str(e)}`)}return{...a,id:i,type:o,function:{...u,name:c,arguments:l}}}))}}}return{...o,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}})),created:n,model:o,object:"chat.completion",...i?{system_fingerprint:i}:{}};return(0,b.maybeParseChatCompletion)(l,t)}function str(e){return JSON.stringify(e)}function assertIsEmpty(e){return}function assertNever(e){}},8231:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.ChatCompletionStreamingRunner=void 0;const r=s(6221);class ChatCompletionStreamingRunner extends r.ChatCompletionStream{static fromReadableStream(e){const t=new ChatCompletionStreamingRunner(null);t._run((()=>t._fromReadableStream(e)));return t}static runTools(e,t,s){const r=new ChatCompletionStreamingRunner(t);const n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};r._run((()=>r._runTools(e,t,n)));return r}}t.ChatCompletionStreamingRunner=ChatCompletionStreamingRunner},7977:(e,t,s)=>{var r,n,o,i,a,l,c,u,d,h,p,f,m;Object.defineProperty(t,"__esModule",{value:true});t.EventStream=void 0;const _=s(6411);const g=s(9171);class EventStream{constructor(){r.add(this);this.controller=new AbortController;n.set(this,void 0);o.set(this,(()=>{}));i.set(this,(()=>{}));a.set(this,void 0);l.set(this,(()=>{}));c.set(this,(()=>{}));u.set(this,{});d.set(this,false);h.set(this,false);p.set(this,false);f.set(this,false);_.__classPrivateFieldSet(this,n,new Promise(((e,t)=>{_.__classPrivateFieldSet(this,o,e,"f");_.__classPrivateFieldSet(this,i,t,"f")})),"f");_.__classPrivateFieldSet(this,a,new Promise(((e,t)=>{_.__classPrivateFieldSet(this,l,e,"f");_.__classPrivateFieldSet(this,c,t,"f")})),"f");_.__classPrivateFieldGet(this,n,"f").catch((()=>{}));_.__classPrivateFieldGet(this,a,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal();this._emit("end")}),_.__classPrivateFieldGet(this,r,"m",m).bind(this))}),0)}_connected(){if(this.ended)return;_.__classPrivateFieldGet(this,o,"f").call(this);this._emit("connect")}get ended(){return _.__classPrivateFieldGet(this,d,"f")}get errored(){return _.__classPrivateFieldGet(this,h,"f")}get aborted(){return _.__classPrivateFieldGet(this,p,"f")}abort(){this.controller.abort()}on(e,t){const s=_.__classPrivateFieldGet(this,u,"f")[e]||(_.__classPrivateFieldGet(this,u,"f")[e]=[]);s.push({listener:t});return this}off(e,t){const s=_.__classPrivateFieldGet(this,u,"f")[e];if(!s)return this;const r=s.findIndex((e=>e.listener===t));if(r>=0)s.splice(r,1);return this}once(e,t){const s=_.__classPrivateFieldGet(this,u,"f")[e]||(_.__classPrivateFieldGet(this,u,"f")[e]=[]);s.push({listener:t,once:true});return this}emitted(e){return new Promise(((t,s)=>{_.__classPrivateFieldSet(this,f,true,"f");if(e!=="error")this.once("error",s);this.once(e,t)}))}async done(){_.__classPrivateFieldSet(this,f,true,"f");await _.__classPrivateFieldGet(this,a,"f")}_emit(e,...t){if(_.__classPrivateFieldGet(this,d,"f")){return}if(e==="end"){_.__classPrivateFieldSet(this,d,true,"f");_.__classPrivateFieldGet(this,l,"f").call(this)}const s=_.__classPrivateFieldGet(this,u,"f")[e];if(s){_.__classPrivateFieldGet(this,u,"f")[e]=s.filter((e=>!e.once));s.forEach((({listener:e})=>e(...t)))}if(e==="abort"){const e=t[0];if(!_.__classPrivateFieldGet(this,f,"f")&&!s?.length){Promise.reject(e)}_.__classPrivateFieldGet(this,i,"f").call(this,e);_.__classPrivateFieldGet(this,c,"f").call(this,e);this._emit("end");return}if(e==="error"){const e=t[0];if(!_.__classPrivateFieldGet(this,f,"f")&&!s?.length){Promise.reject(e)}_.__classPrivateFieldGet(this,i,"f").call(this,e);_.__classPrivateFieldGet(this,c,"f").call(this,e);this._emit("end")}}_emitFinal(){}}t.EventStream=EventStream;n=new WeakMap,o=new WeakMap,i=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,r=new WeakSet,m=function _EventStream_handleError(e){_.__classPrivateFieldSet(this,h,true,"f");if(e instanceof Error&&e.name==="AbortError"){e=new g.APIUserAbortError}if(e instanceof g.APIUserAbortError){_.__classPrivateFieldSet(this,p,true,"f");return this._emit("abort",e)}if(e instanceof g.OpenAIError){return this._emit("error",e)}if(e instanceof Error){const t=new g.OpenAIError(e.message);t.cause=e;return this._emit("error",t)}return this._emit("error",new g.OpenAIError(String(e)))}},1998:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.maybeParseResponse=maybeParseResponse;t.parseResponse=parseResponse;t.hasAutoParseableInput=hasAutoParseableInput;t.makeParseableResponseTool=makeParseableResponseTool;t.isAutoParsableTool=isAutoParsableTool;t.shouldParseToolCall=shouldParseToolCall;t.validateInputTools=validateInputTools;t.addOutputText=addOutputText;const r=s(9171);const n=s(230);function maybeParseResponse(e,t){if(!t||!hasAutoParseableInput(t)){return{...e,output_parsed:null,output:e.output.map((e=>{if(e.type==="function_call"){return{...e,parsed_arguments:null}}if(e.type==="message"){return{...e,content:e.content.map((e=>({...e,parsed:null})))}}else{return e}}))}}return parseResponse(e,t)}function parseResponse(e,t){const s=e.output.map((e=>{if(e.type==="function_call"){return{...e,parsed_arguments:parseToolCall(t,e)}}if(e.type==="message"){const s=e.content.map((e=>{if(e.type==="output_text"){return{...e,parsed:parseTextFormat(t,e.text)}}return e}));return{...e,content:s}}return e}));const r=Object.assign({},e,{output:s});if(!Object.getOwnPropertyDescriptor(e,"output_text")){addOutputText(r)}Object.defineProperty(r,"output_parsed",{enumerable:true,get(){for(const e of r.output){if(e.type!=="message"){continue}for(const t of e.content){if(t.type==="output_text"&&t.parsed!==null){return t.parsed}}}return null}});return r}function parseTextFormat(e,t){if(e.text?.format?.type!=="json_schema"){return null}if("$parseRaw"in e.text?.format){const s=e.text?.format;return s.$parseRaw(t)}return JSON.parse(t)}function hasAutoParseableInput(e){if((0,n.isAutoParsableResponseFormat)(e.text?.format)){return true}return false}function makeParseableResponseTool(e,{parser:t,callback:s}){const r={...e};Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:false},$parseRaw:{value:t,enumerable:false},$callback:{value:s,enumerable:false}});return r}function isAutoParsableTool(e){return e?.["$brand"]==="auto-parseable-tool"}function getInputToolByName(e,t){return e.find((e=>e.type==="function"&&e.name===t))}function parseToolCall(e,t){const s=getInputToolByName(e.tools??[],t.name);return{...t,...t,parsed_arguments:isAutoParsableTool(s)?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}function shouldParseToolCall(e,t){if(!e){return false}const s=getInputToolByName(e.tools??[],t.name);return isAutoParsableTool(s)||s?.strict||false}function validateInputTools(e){for(const t of e??[]){if(t.type!=="function"){throw new r.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``)}if(t.function.strict!==true){throw new r.OpenAIError(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}}function addOutputText(e){const t=[];for(const s of e.output){if(s.type!=="message"){continue}for(const e of s.content){if(e.type==="output_text"){t.push(e.text)}}}e.output_text=t.join("")}},8568:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.ParsingToolFunction=void 0;t.isRunnableFunctionWithParse=isRunnableFunctionWithParse;function isRunnableFunctionWithParse(e){return typeof e.parse==="function"}class ParsingToolFunction{constructor(e){this.type="function";this.function=e}}t.ParsingToolFunction=ParsingToolFunction},3169:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.allSettledWithThrow=void 0;const allSettledWithThrow=async e=>{const t=await Promise.allSettled(e);const s=t.filter((e=>e.status==="rejected"));if(s.length){for(const e of s){console.error(e.reason)}throw new Error(`${s.length} promise(s) failed - see the above errors`)}const r=[];for(const e of t){if(e.status==="fulfilled"){r.push(e.value)}}return r};t.allSettledWithThrow=allSettledWithThrow},116:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.isToolMessage=t.isAssistantMessage=void 0;t.isPresent=isPresent;const isAssistantMessage=e=>e?.role==="assistant";t.isAssistantMessage=isAssistantMessage;const isToolMessage=e=>e?.role==="tool";t.isToolMessage=isToolMessage;function isPresent(e){return e!=null}},230:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.isChatCompletionFunctionTool=isChatCompletionFunctionTool;t.makeParseableResponseFormat=makeParseableResponseFormat;t.makeParseableTextFormat=makeParseableTextFormat;t.isAutoParsableResponseFormat=isAutoParsableResponseFormat;t.makeParseableTool=makeParseableTool;t.isAutoParsableTool=isAutoParsableTool;t.maybeParseChatCompletion=maybeParseChatCompletion;t.parseChatCompletion=parseChatCompletion;t.shouldParseToolCall=shouldParseToolCall;t.hasAutoParseableInput=hasAutoParseableInput;t.assertToolCallsAreChatCompletionFunctionToolCalls=assertToolCallsAreChatCompletionFunctionToolCalls;t.validateInputTools=validateInputTools;const r=s(9171);function isChatCompletionFunctionTool(e){return e!==undefined&&"function"in e&&e.function!==undefined}function makeParseableResponseFormat(e,t){const s={...e};Object.defineProperties(s,{$brand:{value:"auto-parseable-response-format",enumerable:false},$parseRaw:{value:t,enumerable:false}});return s}function makeParseableTextFormat(e,t){const s={...e};Object.defineProperties(s,{$brand:{value:"auto-parseable-response-format",enumerable:false},$parseRaw:{value:t,enumerable:false}});return s}function isAutoParsableResponseFormat(e){return e?.["$brand"]==="auto-parseable-response-format"}function makeParseableTool(e,{parser:t,callback:s}){const r={...e};Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:false},$parseRaw:{value:t,enumerable:false},$callback:{value:s,enumerable:false}});return r}function isAutoParsableTool(e){return e?.["$brand"]==="auto-parseable-tool"}function maybeParseChatCompletion(e,t){if(!t||!hasAutoParseableInput(t)){return{...e,choices:e.choices.map((e=>{assertToolCallsAreChatCompletionFunctionToolCalls(e.message.tool_calls);return{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:undefined}}}))}}return parseChatCompletion(e,t)}function parseChatCompletion(e,t){const s=e.choices.map((e=>{if(e.finish_reason==="length"){throw new r.LengthFinishReasonError}if(e.finish_reason==="content_filter"){throw new r.ContentFilterFinishReasonError}assertToolCallsAreChatCompletionFunctionToolCalls(e.message.tool_calls);return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map((e=>parseToolCall(t,e)))??undefined}:undefined,parsed:e.message.content&&!e.message.refusal?parseResponseFormat(t,e.message.content):null}}}));return{...e,choices:s}}function parseResponseFormat(e,t){if(e.response_format?.type!=="json_schema"){return null}if(e.response_format?.type==="json_schema"){if("$parseRaw"in e.response_format){const s=e.response_format;return s.$parseRaw(t)}return JSON.parse(t)}return null}function parseToolCall(e,t){const s=e.tools?.find((e=>isChatCompletionFunctionTool(e)&&e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:isAutoParsableTool(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}}function shouldParseToolCall(e,t){if(!e||!("tools"in e)||!e.tools){return false}const s=e.tools?.find((e=>isChatCompletionFunctionTool(e)&&e.function?.name===t.function.name));return isChatCompletionFunctionTool(s)&&(isAutoParsableTool(s)||s?.function.strict||false)}function hasAutoParseableInput(e){if(isAutoParsableResponseFormat(e.response_format)){return true}return e.tools?.some((e=>isAutoParsableTool(e)||e.type==="function"&&e.function.strict===true))??false}function assertToolCallsAreChatCompletionFunctionToolCalls(e){for(const t of e||[]){if(t.type!=="function"){throw new r.OpenAIError(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}}}function validateInputTools(e){for(const t of e??[]){if(t.type!=="function"){throw new r.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``)}if(t.function.strict!==true){throw new r.OpenAIError(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}}},7800:(e,t,s)=>{var r,n,o,i,a,l,c,u;Object.defineProperty(t,"__esModule",{value:true});t.ResponseStream=void 0;const d=s(6411);const h=s(9171);const p=s(7977);const f=s(1998);class ResponseStream extends p.EventStream{constructor(e){super();r.add(this);n.set(this,void 0);o.set(this,void 0);i.set(this,void 0);d.__classPrivateFieldSet(this,n,e,"f")}static createResponse(e,t,s){const r=new ResponseStream(t);r._run((()=>r._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})));return r}async _createOrRetrieveResponse(e,t,s){const n=s?.signal;if(n){if(n.aborted)this.controller.abort();n.addEventListener("abort",(()=>this.controller.abort()))}d.__classPrivateFieldGet(this,r,"m",a).call(this);let o;let i=null;if("response_id"in t){o=await e.responses.retrieve(t.response_id,{stream:true},{...s,signal:this.controller.signal,stream:true});i=t.starting_after??null}else{o=await e.responses.create({...t,stream:true},{...s,signal:this.controller.signal})}this._connected();for await(const e of o){d.__classPrivateFieldGet(this,r,"m",l).call(this,e,i)}if(o.controller.signal?.aborted){throw new h.APIUserAbortError}return d.__classPrivateFieldGet(this,r,"m",c).call(this)}[(n=new WeakMap,o=new WeakMap,i=new WeakMap,r=new WeakSet,a=function _ResponseStream_beginRequest(){if(this.ended)return;d.__classPrivateFieldSet(this,o,undefined,"f")},l=function _ResponseStream_addEvent(e,t){if(this.ended)return;const maybeEmit=(e,s)=>{if(t==null||s.sequence_number>t){this._emit(e,s)}};const s=d.__classPrivateFieldGet(this,r,"m",u).call(this,e);maybeEmit("event",e);switch(e.type){case"response.output_text.delta":{const t=s.output[e.output_index];if(!t){throw new h.OpenAIError(`missing output at index ${e.output_index}`)}if(t.type==="message"){const s=t.content[e.content_index];if(!s){throw new h.OpenAIError(`missing content at index ${e.content_index}`)}if(s.type!=="output_text"){throw new h.OpenAIError(`expected content to be 'output_text', got ${s.type}`)}maybeEmit("response.output_text.delta",{...e,snapshot:s.text})}break}case"response.function_call_arguments.delta":{const t=s.output[e.output_index];if(!t){throw new h.OpenAIError(`missing output at index ${e.output_index}`)}if(t.type==="function_call"){maybeEmit("response.function_call_arguments.delta",{...e,snapshot:t.arguments})}break}default:maybeEmit(e.type,e);break}},c=function _ResponseStream_endRequest(){if(this.ended){throw new h.OpenAIError(`stream has ended, this shouldn't happen`)}const e=d.__classPrivateFieldGet(this,o,"f");if(!e){throw new h.OpenAIError(`request ended without sending any events`)}d.__classPrivateFieldSet(this,o,undefined,"f");const t=finalizeResponse(e,d.__classPrivateFieldGet(this,n,"f"));d.__classPrivateFieldSet(this,i,t,"f");return t},u=function _ResponseStream_accumulateResponse(e){let t=d.__classPrivateFieldGet(this,o,"f");if(!t){if(e.type!=="response.created"){throw new h.OpenAIError(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`)}t=d.__classPrivateFieldSet(this,o,e.response,"f");return t}switch(e.type){case"response.output_item.added":{t.output.push(e.item);break}case"response.content_part.added":{const s=t.output[e.output_index];if(!s){throw new h.OpenAIError(`missing output at index ${e.output_index}`)}const r=s.type;const n=e.part;if(r==="message"&&n.type!=="reasoning_text"){s.content.push(n)}else if(r==="reasoning"&&n.type==="reasoning_text"){if(!s.content){s.content=[]}s.content.push(n)}break}case"response.output_text.delta":{const s=t.output[e.output_index];if(!s){throw new h.OpenAIError(`missing output at index ${e.output_index}`)}if(s.type==="message"){const t=s.content[e.content_index];if(!t){throw new h.OpenAIError(`missing content at index ${e.content_index}`)}if(t.type!=="output_text"){throw new h.OpenAIError(`expected content to be 'output_text', got ${t.type}`)}t.text+=e.delta}break}case"response.function_call_arguments.delta":{const s=t.output[e.output_index];if(!s){throw new h.OpenAIError(`missing output at index ${e.output_index}`)}if(s.type==="function_call"){s.arguments+=e.delta}break}case"response.reasoning_text.delta":{const s=t.output[e.output_index];if(!s){throw new h.OpenAIError(`missing output at index ${e.output_index}`)}if(s.type==="reasoning"){const t=s.content?.[e.content_index];if(!t){throw new h.OpenAIError(`missing content at index ${e.content_index}`)}if(t.type!=="reasoning_text"){throw new h.OpenAIError(`expected content to be 'reasoning_text', got ${t.type}`)}t.text+=e.delta}break}case"response.completed":{d.__classPrivateFieldSet(this,o,e.response,"f");break}}return t},Symbol.asyncIterator)](){const e=[];const t=[];let s=false;this.on("event",(s=>{const r=t.shift();if(r){r.resolve(s)}else{e.push(s)}}));this.on("end",(()=>{s=true;for(const e of t){e.resolve(undefined)}t.length=0}));this.on("abort",(e=>{s=true;for(const s of t){s.reject(e)}t.length=0}));this.on("error",(e=>{s=true;for(const s of t){s.reject(e)}t.length=0}));return{next:async()=>{if(!e.length){if(s){return{value:undefined,done:true}}return new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:false}:{value:undefined,done:true}))}const r=e.shift();return{value:r,done:false}},return:async()=>{this.abort();return{value:undefined,done:true}}}}async finalResponse(){await this.done();const e=d.__classPrivateFieldGet(this,i,"f");if(!e)throw new h.OpenAIError("stream ended without producing a ChatCompletion");return e}}t.ResponseStream=ResponseStream;function finalizeResponse(e,t){return(0,f.maybeParseResponse)(e,t)}},748:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Audio=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(4606));const i=s(4606);const a=r.__importStar(s(2837));const l=s(2837);const c=r.__importStar(s(9240));const u=s(9240);class Audio extends n.APIResource{constructor(){super(...arguments);this.transcriptions=new a.Transcriptions(this._client);this.translations=new c.Translations(this._client);this.speech=new o.Speech(this._client)}}t.Audio=Audio;Audio.Transcriptions=l.Transcriptions;Audio.Translations=u.Translations;Audio.Speech=i.Speech},4606:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Speech=void 0;const r=s(4945);const n=s(3773);class Speech extends r.APIResource{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:(0,n.buildHeaders)([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:true})}}t.Speech=Speech},2837:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Transcriptions=void 0;const r=s(4945);const n=s(8561);class Transcriptions extends r.APIResource{create(e,t){return this._client.post("/audio/transcriptions",(0,n.multipartFormRequestOptions)({body:e,...t,stream:e.stream??false,__metadata:{model:e.model}},this._client))}}t.Transcriptions=Transcriptions},9240:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Translations=void 0;const r=s(4945);const n=s(8561);class Translations extends r.APIResource{create(e,t){return this._client.post("/audio/translations",(0,n.multipartFormRequestOptions)({body:e,...t,__metadata:{model:e.model}},this._client))}}t.Translations=Translations},1663:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Batches=void 0;const r=s(4945);const n=s(5049);const o=s(574);class Batches extends r.APIResource{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get((0,o.path)`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",n.CursorPage,{query:e,...t})}cancel(e,t){return this._client.post((0,o.path)`/batches/${e}/cancel`,t)}}t.Batches=Batches},2193:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Assistants=void 0;const r=s(4945);const n=s(5049);const o=s(3773);const i=s(574);class Assistants extends r.APIResource{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get((0,i.path)`/assistants/${e}`,{...t,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post((0,i.path)`/assistants/${e}`,{body:t,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",n.CursorPage,{query:e,...t,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete((0,i.path)`/assistants/${e}`,{...t,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}t.Assistants=Assistants},4282:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Beta=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(2193));const i=s(2193);const a=r.__importStar(s(3249));const l=s(3249);const c=r.__importStar(s(7573));const u=s(7573);const d=r.__importStar(s(9609));const h=s(9609);class Beta extends n.APIResource{constructor(){super(...arguments);this.realtime=new a.Realtime(this._client);this.chatkit=new c.ChatKit(this._client);this.assistants=new o.Assistants(this._client);this.threads=new d.Threads(this._client)}}t.Beta=Beta;Beta.Realtime=l.Realtime;Beta.ChatKit=u.ChatKit;Beta.Assistants=i.Assistants;Beta.Threads=h.Threads},7573:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.ChatKit=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(3286));const i=s(3286);const a=r.__importStar(s(5026));const l=s(5026);class ChatKit extends n.APIResource{constructor(){super(...arguments);this.sessions=new o.Sessions(this._client);this.threads=new a.Threads(this._client)}}t.ChatKit=ChatKit;ChatKit.Sessions=i.Sessions;ChatKit.Threads=l.Threads},3286:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Sessions=void 0;const r=s(4945);const n=s(3773);const o=s(574);class Sessions extends r.APIResource{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:(0,n.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post((0,o.path)`/chatkit/sessions/${e}/cancel`,{...t,headers:(0,n.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}t.Sessions=Sessions},5026:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Threads=void 0;const r=s(4945);const n=s(5049);const o=s(3773);const i=s(574);class Threads extends r.APIResource{retrieve(e,t){return this._client.get((0,i.path)`/chatkit/threads/${e}`,{...t,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",n.ConversationCursorPage,{query:e,...t,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete((0,i.path)`/chatkit/threads/${e}`,{...t,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList((0,i.path)`/chatkit/threads/${e}/items`,n.ConversationCursorPage,{query:t,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}}t.Threads=Threads},3249:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Realtime=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(5653));const i=s(5653);const a=r.__importStar(s(118));const l=s(118);class Realtime extends n.APIResource{constructor(){super(...arguments);this.sessions=new o.Sessions(this._client);this.transcriptionSessions=new a.TranscriptionSessions(this._client)}}t.Realtime=Realtime;Realtime.Sessions=i.Sessions;Realtime.TranscriptionSessions=l.TranscriptionSessions},5653:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Sessions=void 0;const r=s(4945);const n=s(3773);class Sessions extends r.APIResource{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:(0,n.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}t.Sessions=Sessions},118:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.TranscriptionSessions=void 0;const r=s(4945);const n=s(3773);class TranscriptionSessions extends r.APIResource{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:(0,n.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}t.TranscriptionSessions=TranscriptionSessions},3870:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Messages=void 0;const r=s(4945);const n=s(5049);const o=s(3773);const i=s(574);class Messages extends r.APIResource{create(e,t,s){return this._client.post((0,i.path)`/threads/${e}/messages`,{body:t,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){const{thread_id:r}=t;return this._client.get((0,i.path)`/threads/${r}/messages/${e}`,{...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){const{thread_id:r,...n}=t;return this._client.post((0,i.path)`/threads/${r}/messages/${e}`,{body:n,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList((0,i.path)`/threads/${e}/messages`,n.CursorPage,{query:t,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){const{thread_id:r}=t;return this._client.delete((0,i.path)`/threads/${r}/messages/${e}`,{...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}t.Messages=Messages},7937:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Runs=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(7316));const i=s(7316);const a=s(5049);const l=s(3773);const c=s(6825);const u=s(1226);const d=s(574);class Runs extends n.APIResource{constructor(){super(...arguments);this.steps=new o.Steps(this._client)}create(e,t,s){const{include:r,...n}=t;return this._client.post((0,d.path)`/threads/${e}/runs`,{query:{include:r},body:n,...s,headers:(0,l.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??false})}retrieve(e,t,s){const{thread_id:r}=t;return this._client.get((0,d.path)`/threads/${r}/runs/${e}`,{...s,headers:(0,l.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){const{thread_id:r,...n}=t;return this._client.post((0,d.path)`/threads/${r}/runs/${e}`,{body:n,...s,headers:(0,l.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList((0,d.path)`/threads/${e}/runs`,a.CursorPage,{query:t,...s,headers:(0,l.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){const{thread_id:r}=t;return this._client.post((0,d.path)`/threads/${r}/runs/${e}/cancel`,{...s,headers:(0,l.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t,s);return await this.poll(r.id,{thread_id:e},s)}createAndStream(e,t,s){return c.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){const r=(0,l.buildHeaders)([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??undefined}]);while(true){const{data:n,response:o}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...r}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(s?.pollIntervalMs){e=s.pollIntervalMs}else{const t=o.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);if(!isNaN(s)){e=s}}}await(0,u.sleep)(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,s){return c.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){const{thread_id:r,...n}=t;return this._client.post((0,d.path)`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:n,...s,headers:(0,l.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??false})}async submitToolOutputsAndPoll(e,t,s){const r=await this.submitToolOutputs(e,t,s);return await this.poll(r.id,t,s)}submitToolOutputsStream(e,t,s){return c.AssistantStream.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}t.Runs=Runs;Runs.Steps=i.Steps},7316:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Steps=void 0;const r=s(4945);const n=s(5049);const o=s(3773);const i=s(574);class Steps extends r.APIResource{retrieve(e,t,s){const{thread_id:r,run_id:n,...a}=t;return this._client.get((0,i.path)`/threads/${r}/runs/${n}/steps/${e}`,{query:a,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){const{thread_id:r,...a}=t;return this._client.getAPIList((0,i.path)`/threads/${r}/runs/${e}/steps`,n.CursorPage,{query:a,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}t.Steps=Steps},9609:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Threads=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(3870));const i=s(3870);const a=r.__importStar(s(7937));const l=s(7937);const c=s(3773);const u=s(6825);const d=s(574);class Threads extends n.APIResource{constructor(){super(...arguments);this.runs=new a.Runs(this._client);this.messages=new o.Messages(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:(0,c.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get((0,d.path)`/threads/${e}`,{...t,headers:(0,c.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post((0,d.path)`/threads/${e}`,{body:t,...s,headers:(0,c.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete((0,d.path)`/threads/${e}`,{...t,headers:(0,c.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:(0,c.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??false})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return u.AssistantStream.createThreadAssistantStream(e,this._client.beta.threads,t)}}t.Threads=Threads;Threads.Runs=l.Runs;Threads.Messages=i.Messages},4066:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Chat=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(3157));const i=s(3157);class Chat extends n.APIResource{constructor(){super(...arguments);this.completions=new o.Completions(this._client)}}t.Chat=Chat;Chat.Completions=i.Completions},3157:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.ChatCompletionRunner=t.ChatCompletionStream=t.ParsingToolFunction=t.ChatCompletionStreamingRunner=t.Completions=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(4168));const i=s(4168);const a=s(5049);const l=s(574);const c=s(5419);const u=s(8231);const d=s(6221);const h=s(230);class Completions extends n.APIResource{constructor(){super(...arguments);this.messages=new o.Messages(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??false})}retrieve(e,t){return this._client.get((0,l.path)`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post((0,l.path)`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",a.CursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,l.path)`/chat/completions/${e}`,t)}parse(e,t){(0,h.validateInputTools)(e.tools);return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap((t=>(0,h.parseChatCompletion)(t,e)))}runTools(e,t){if(e.stream){return u.ChatCompletionStreamingRunner.runTools(this._client,e,t)}return c.ChatCompletionRunner.runTools(this._client,e,t)}stream(e,t){return d.ChatCompletionStream.createChatCompletion(this._client,e,t)}}t.Completions=Completions;var p=s(8231);Object.defineProperty(t,"ChatCompletionStreamingRunner",{enumerable:true,get:function(){return p.ChatCompletionStreamingRunner}});var f=s(8568);Object.defineProperty(t,"ParsingToolFunction",{enumerable:true,get:function(){return f.ParsingToolFunction}});var m=s(6221);Object.defineProperty(t,"ChatCompletionStream",{enumerable:true,get:function(){return m.ChatCompletionStream}});var _=s(5419);Object.defineProperty(t,"ChatCompletionRunner",{enumerable:true,get:function(){return _.ChatCompletionRunner}});Completions.Messages=i.Messages},362:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Messages=t.Completions=void 0;const r=s(6411);var n=s(3157);Object.defineProperty(t,"Completions",{enumerable:true,get:function(){return n.Completions}});r.__exportStar(s(3157),t);var o=s(4168);Object.defineProperty(t,"Messages",{enumerable:true,get:function(){return o.Messages}})},4168:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Messages=void 0;const r=s(4945);const n=s(5049);const o=s(574);class Messages extends r.APIResource{list(e,t={},s){return this._client.getAPIList((0,o.path)`/chat/completions/${e}/messages`,n.CursorPage,{query:t,...s})}}t.Messages=Messages},7590:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Completions=t.Chat=void 0;var r=s(4066);Object.defineProperty(t,"Chat",{enumerable:true,get:function(){return r.Chat}});var n=s(362);Object.defineProperty(t,"Completions",{enumerable:true,get:function(){return n.Completions}})},2752:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Completions=void 0;const r=s(4945);class Completions extends r.APIResource{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??false})}}t.Completions=Completions},7402:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Containers=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(2319));const i=s(2319);const a=s(5049);const l=s(3773);const c=s(574);class Containers extends n.APIResource{constructor(){super(...arguments);this.files=new o.Files(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get((0,c.path)`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",a.CursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,c.path)`/containers/${e}`,{...t,headers:(0,l.buildHeaders)([{Accept:"*/*"},t?.headers])})}}t.Containers=Containers;Containers.Files=i.Files},6365:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Content=void 0;const r=s(4945);const n=s(3773);const o=s(574);class Content extends r.APIResource{retrieve(e,t,s){const{container_id:r}=t;return this._client.get((0,o.path)`/containers/${r}/files/${e}/content`,{...s,headers:(0,n.buildHeaders)([{Accept:"application/binary"},s?.headers]),__binaryResponse:true})}}t.Content=Content},2319:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Files=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(6365));const i=s(6365);const a=s(5049);const l=s(3773);const c=s(8561);const u=s(574);class Files extends n.APIResource{constructor(){super(...arguments);this.content=new o.Content(this._client)}create(e,t,s){return this._client.post((0,u.path)`/containers/${e}/files`,(0,c.multipartFormRequestOptions)({body:t,...s},this._client))}retrieve(e,t,s){const{container_id:r}=t;return this._client.get((0,u.path)`/containers/${r}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList((0,u.path)`/containers/${e}/files`,a.CursorPage,{query:t,...s})}delete(e,t,s){const{container_id:r}=t;return this._client.delete((0,u.path)`/containers/${r}/files/${e}`,{...s,headers:(0,l.buildHeaders)([{Accept:"*/*"},s?.headers])})}}t.Files=Files;Files.Content=i.Content},3124:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Conversations=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(7988));const i=s(7988);const a=s(574);class Conversations extends n.APIResource{constructor(){super(...arguments);this.items=new o.Items(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get((0,a.path)`/conversations/${e}`,t)}update(e,t,s){return this._client.post((0,a.path)`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete((0,a.path)`/conversations/${e}`,t)}}t.Conversations=Conversations;Conversations.Items=i.Items},7988:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Items=void 0;const r=s(4945);const n=s(5049);const o=s(574);class Items extends r.APIResource{create(e,t,s){const{include:r,...n}=t;return this._client.post((0,o.path)`/conversations/${e}/items`,{query:{include:r},body:n,...s})}retrieve(e,t,s){const{conversation_id:r,...n}=t;return this._client.get((0,o.path)`/conversations/${r}/items/${e}`,{query:n,...s})}list(e,t={},s){return this._client.getAPIList((0,o.path)`/conversations/${e}/items`,n.ConversationCursorPage,{query:t,...s})}delete(e,t,s){const{conversation_id:r}=t;return this._client.delete((0,o.path)`/conversations/${r}/items/${e}`,s)}}t.Items=Items},6009:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Embeddings=void 0;const r=s(4945);const n=s(4294);class Embeddings extends r.APIResource{create(e,t){const s=!!e.encoding_format;let r=s?e.encoding_format:"base64";if(s){(0,n.loggerFor)(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format)}const o=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});if(s){return o}(0,n.loggerFor)(this._client).debug("embeddings/decoding base64 embeddings from base64");return o._thenUnwrap((e=>{if(e&&e.data){e.data.forEach((e=>{const t=e.embedding;e.embedding=(0,n.toFloat32Array)(t)}))}return e}))}}t.Embeddings=Embeddings},9528:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Evals=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(6958));const i=s(6958);const a=s(5049);const l=s(574);class Evals extends n.APIResource{constructor(){super(...arguments);this.runs=new o.Runs(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get((0,l.path)`/evals/${e}`,t)}update(e,t,s){return this._client.post((0,l.path)`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",a.CursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,l.path)`/evals/${e}`,t)}}t.Evals=Evals;Evals.Runs=i.Runs},6616:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.OutputItems=void 0;const r=s(4945);const n=s(5049);const o=s(574);class OutputItems extends r.APIResource{retrieve(e,t,s){const{eval_id:r,run_id:n}=t;return this._client.get((0,o.path)`/evals/${r}/runs/${n}/output_items/${e}`,s)}list(e,t,s){const{eval_id:r,...i}=t;return this._client.getAPIList((0,o.path)`/evals/${r}/runs/${e}/output_items`,n.CursorPage,{query:i,...s})}}t.OutputItems=OutputItems},6958:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Runs=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(6616));const i=s(6616);const a=s(5049);const l=s(574);class Runs extends n.APIResource{constructor(){super(...arguments);this.outputItems=new o.OutputItems(this._client)}create(e,t,s){return this._client.post((0,l.path)`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){const{eval_id:r}=t;return this._client.get((0,l.path)`/evals/${r}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList((0,l.path)`/evals/${e}/runs`,a.CursorPage,{query:t,...s})}delete(e,t,s){const{eval_id:r}=t;return this._client.delete((0,l.path)`/evals/${r}/runs/${e}`,s)}cancel(e,t,s){const{eval_id:r}=t;return this._client.post((0,l.path)`/evals/${r}/runs/${e}`,s)}}t.Runs=Runs;Runs.OutputItems=i.OutputItems},3048:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Files=void 0;const r=s(4945);const n=s(5049);const o=s(3773);const i=s(1226);const a=s(9171);const l=s(8561);const c=s(574);class Files extends r.APIResource{create(e,t){return this._client.post("/files",(0,l.multipartFormRequestOptions)({body:e,...t},this._client))}retrieve(e,t){return this._client.get((0,c.path)`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",n.CursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,c.path)`/files/${e}`,t)}content(e,t){return this._client.get((0,c.path)`/files/${e}/content`,{...t,headers:(0,o.buildHeaders)([{Accept:"application/binary"},t?.headers]),__binaryResponse:true})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]);const n=Date.now();let o=await this.retrieve(e);while(!o.status||!r.has(o.status)){await(0,i.sleep)(t);o=await this.retrieve(e);if(Date.now()-n>s){throw new a.APIConnectionTimeoutError({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`})}}return o}}t.Files=Files},3345:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Alpha=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(8537));const i=s(8537);class Alpha extends n.APIResource{constructor(){super(...arguments);this.graders=new o.Graders(this._client)}}t.Alpha=Alpha;Alpha.Graders=i.Graders},8537:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Graders=void 0;const r=s(4945);class Graders extends r.APIResource{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}t.Graders=Graders},3785:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Checkpoints=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(2769));const i=s(2769);class Checkpoints extends n.APIResource{constructor(){super(...arguments);this.permissions=new o.Permissions(this._client)}}t.Checkpoints=Checkpoints;Checkpoints.Permissions=i.Permissions},2769:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Permissions=void 0;const r=s(4945);const n=s(5049);const o=s(574);class Permissions extends r.APIResource{create(e,t,s){return this._client.getAPIList((0,o.path)`/fine_tuning/checkpoints/${e}/permissions`,n.Page,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get((0,o.path)`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete((0,o.path)`/fine_tuning/checkpoints/${r}/permissions/${e}`,s)}}t.Permissions=Permissions},3444:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.FineTuning=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(2760));const i=s(2760);const a=r.__importStar(s(3345));const l=s(3345);const c=r.__importStar(s(3785));const u=s(3785);const d=r.__importStar(s(8507));const h=s(8507);class FineTuning extends n.APIResource{constructor(){super(...arguments);this.methods=new o.Methods(this._client);this.jobs=new d.Jobs(this._client);this.checkpoints=new c.Checkpoints(this._client);this.alpha=new a.Alpha(this._client)}}t.FineTuning=FineTuning;FineTuning.Methods=i.Methods;FineTuning.Jobs=h.Jobs;FineTuning.Checkpoints=u.Checkpoints;FineTuning.Alpha=l.Alpha},2720:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Checkpoints=void 0;const r=s(4945);const n=s(5049);const o=s(574);class Checkpoints extends r.APIResource{list(e,t={},s){return this._client.getAPIList((0,o.path)`/fine_tuning/jobs/${e}/checkpoints`,n.CursorPage,{query:t,...s})}}t.Checkpoints=Checkpoints},8507:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Jobs=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(2720));const i=s(2720);const a=s(5049);const l=s(574);class Jobs extends n.APIResource{constructor(){super(...arguments);this.checkpoints=new o.Checkpoints(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get((0,l.path)`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",a.CursorPage,{query:e,...t})}cancel(e,t){return this._client.post((0,l.path)`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList((0,l.path)`/fine_tuning/jobs/${e}/events`,a.CursorPage,{query:t,...s})}pause(e,t){return this._client.post((0,l.path)`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post((0,l.path)`/fine_tuning/jobs/${e}/resume`,t)}}t.Jobs=Jobs;Jobs.Checkpoints=i.Checkpoints},2760:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Methods=void 0;const r=s(4945);class Methods extends r.APIResource{}t.Methods=Methods},712:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.GraderModels=void 0;const r=s(4945);class GraderModels extends r.APIResource{}t.GraderModels=GraderModels},392:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Graders=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(712));const i=s(712);class Graders extends n.APIResource{constructor(){super(...arguments);this.graderModels=new o.GraderModels(this._client)}}t.Graders=Graders;Graders.GraderModels=i.GraderModels},6297:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Images=void 0;const r=s(4945);const n=s(8561);class Images extends r.APIResource{createVariation(e,t){return this._client.post("/images/variations",(0,n.multipartFormRequestOptions)({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",(0,n.multipartFormRequestOptions)({body:e,...t,stream:e.stream??false},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??false})}}t.Images=Images},47:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Webhooks=t.Videos=t.VectorStores=t.Uploads=t.Responses=t.Realtime=t.Moderations=t.Models=t.Images=t.Graders=t.FineTuning=t.Files=t.Evals=t.Embeddings=t.Conversations=t.Containers=t.Completions=t.Beta=t.Batches=t.Audio=void 0;const r=s(6411);r.__exportStar(s(7590),t);r.__exportStar(s(282),t);var n=s(748);Object.defineProperty(t,"Audio",{enumerable:true,get:function(){return n.Audio}});var o=s(1663);Object.defineProperty(t,"Batches",{enumerable:true,get:function(){return o.Batches}});var i=s(4282);Object.defineProperty(t,"Beta",{enumerable:true,get:function(){return i.Beta}});var a=s(2752);Object.defineProperty(t,"Completions",{enumerable:true,get:function(){return a.Completions}});var l=s(7402);Object.defineProperty(t,"Containers",{enumerable:true,get:function(){return l.Containers}});var c=s(3124);Object.defineProperty(t,"Conversations",{enumerable:true,get:function(){return c.Conversations}});var u=s(6009);Object.defineProperty(t,"Embeddings",{enumerable:true,get:function(){return u.Embeddings}});var d=s(9528);Object.defineProperty(t,"Evals",{enumerable:true,get:function(){return d.Evals}});var h=s(3048);Object.defineProperty(t,"Files",{enumerable:true,get:function(){return h.Files}});var p=s(3444);Object.defineProperty(t,"FineTuning",{enumerable:true,get:function(){return p.FineTuning}});var f=s(392);Object.defineProperty(t,"Graders",{enumerable:true,get:function(){return f.Graders}});var m=s(6297);Object.defineProperty(t,"Images",{enumerable:true,get:function(){return m.Images}});var _=s(521);Object.defineProperty(t,"Models",{enumerable:true,get:function(){return _.Models}});var g=s(9478);Object.defineProperty(t,"Moderations",{enumerable:true,get:function(){return g.Moderations}});var b=s(5736);Object.defineProperty(t,"Realtime",{enumerable:true,get:function(){return b.Realtime}});var y=s(1772);Object.defineProperty(t,"Responses",{enumerable:true,get:function(){return y.Responses}});var v=s(4560);Object.defineProperty(t,"Uploads",{enumerable:true,get:function(){return v.Uploads}});var P=s(5324);Object.defineProperty(t,"VectorStores",{enumerable:true,get:function(){return P.VectorStores}});var w=s(907);Object.defineProperty(t,"Videos",{enumerable:true,get:function(){return w.Videos}});var A=s(221);Object.defineProperty(t,"Webhooks",{enumerable:true,get:function(){return A.Webhooks}})},521:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Models=void 0;const r=s(4945);const n=s(5049);const o=s(574);class Models extends r.APIResource{retrieve(e,t){return this._client.get((0,o.path)`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",n.Page,e)}delete(e,t){return this._client.delete((0,o.path)`/models/${e}`,t)}}t.Models=Models},9478:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Moderations=void 0;const r=s(4945);class Moderations extends r.APIResource{create(e,t){return this._client.post("/moderations",{body:e,...t})}}t.Moderations=Moderations},2748:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Calls=void 0;const r=s(4945);const n=s(3773);const o=s(574);class Calls extends r.APIResource{accept(e,t,s){return this._client.post((0,o.path)`/realtime/calls/${e}/accept`,{body:t,...s,headers:(0,n.buildHeaders)([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post((0,o.path)`/realtime/calls/${e}/hangup`,{...t,headers:(0,n.buildHeaders)([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post((0,o.path)`/realtime/calls/${e}/refer`,{body:t,...s,headers:(0,n.buildHeaders)([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post((0,o.path)`/realtime/calls/${e}/reject`,{body:t,...s,headers:(0,n.buildHeaders)([{Accept:"*/*"},s?.headers])})}}t.Calls=Calls},1602:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.ClientSecrets=void 0;const r=s(4945);class ClientSecrets extends r.APIResource{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}t.ClientSecrets=ClientSecrets},5736:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Realtime=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(2748));const i=s(2748);const a=r.__importStar(s(1602));const l=s(1602);class Realtime extends n.APIResource{constructor(){super(...arguments);this.clientSecrets=new a.ClientSecrets(this._client);this.calls=new o.Calls(this._client)}}t.Realtime=Realtime;Realtime.ClientSecrets=l.ClientSecrets;Realtime.Calls=i.Calls},5593:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.InputItems=void 0;const r=s(4945);const n=s(5049);const o=s(574);class InputItems extends r.APIResource{list(e,t={},s){return this._client.getAPIList((0,o.path)`/responses/${e}/input_items`,n.CursorPage,{query:t,...s})}}t.InputItems=InputItems},5971:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.InputTokens=void 0;const r=s(4945);class InputTokens extends r.APIResource{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}t.InputTokens=InputTokens},1772:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Responses=void 0;const r=s(6411);const n=s(1998);const o=s(7800);const i=s(4945);const a=r.__importStar(s(5593));const l=s(5593);const c=r.__importStar(s(5971));const u=s(5971);const d=s(3773);const h=s(574);class Responses extends i.APIResource{constructor(){super(...arguments);this.inputItems=new a.InputItems(this._client);this.inputTokens=new c.InputTokens(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??false})._thenUnwrap((e=>{if("object"in e&&e.object==="response"){(0,n.addOutputText)(e)}return e}))}retrieve(e,t={},s){return this._client.get((0,h.path)`/responses/${e}`,{query:t,...s,stream:t?.stream??false})._thenUnwrap((e=>{if("object"in e&&e.object==="response"){(0,n.addOutputText)(e)}return e}))}delete(e,t){return this._client.delete((0,h.path)`/responses/${e}`,{...t,headers:(0,d.buildHeaders)([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap((t=>(0,n.parseResponse)(t,e)))}stream(e,t){return o.ResponseStream.createResponse(this._client,e,t)}cancel(e,t){return this._client.post((0,h.path)`/responses/${e}/cancel`,t)}compact(e,t){return this._client.post("/responses/compact",{body:e,...t})}}t.Responses=Responses;Responses.InputItems=l.InputItems;Responses.InputTokens=u.InputTokens},282:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true})},7944:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Parts=void 0;const r=s(4945);const n=s(8561);const o=s(574);class Parts extends r.APIResource{create(e,t,s){return this._client.post((0,o.path)`/uploads/${e}/parts`,(0,n.multipartFormRequestOptions)({body:t,...s},this._client))}}t.Parts=Parts},4560:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Uploads=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(7944));const i=s(7944);const a=s(574);class Uploads extends n.APIResource{constructor(){super(...arguments);this.parts=new o.Parts(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post((0,a.path)`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post((0,a.path)`/uploads/${e}/complete`,{body:t,...s})}}t.Uploads=Uploads;Uploads.Parts=i.Parts},5873:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.FileBatches=void 0;const r=s(4945);const n=s(5049);const o=s(3773);const i=s(1226);const a=s(3169);const l=s(574);class FileBatches extends r.APIResource{create(e,t,s){return this._client.post((0,l.path)`/vector_stores/${e}/file_batches`,{body:t,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){const{vector_store_id:r}=t;return this._client.get((0,l.path)`/vector_stores/${r}/file_batches/${e}`,{...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){const{vector_store_id:r}=t;return this._client.post((0,l.path)`/vector_stores/${r}/file_batches/${e}/cancel`,{...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t);return await this.poll(e,r.id,s)}listFiles(e,t,s){const{vector_store_id:r,...i}=t;return this._client.getAPIList((0,l.path)`/vector_stores/${r}/file_batches/${e}/files`,n.CursorPage,{query:i,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){const r=(0,o.buildHeaders)([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??undefined}]);while(true){const{data:n,response:o}=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse();switch(n.status){case"in_progress":let e=5e3;if(s?.pollIntervalMs){e=s.pollIntervalMs}else{const t=o.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);if(!isNaN(s)){e=s}}}await(0,i.sleep)(e);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},r){if(t==null||t.length==0){throw new Error(`No \`files\` provided to process. If you've already uploaded files you should use \`.createAndPoll()\` instead`)}const n=r?.maxConcurrency??5;const o=Math.min(n,t.length);const i=this._client;const l=t.values();const c=[...s];async function processFiles(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},r);c.push(e.id)}}const u=Array(o).fill(l).map(processFiles);await(0,a.allSettledWithThrow)(u);return await this.createAndPoll(e,{file_ids:c})}}t.FileBatches=FileBatches},9271:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Files=void 0;const r=s(4945);const n=s(5049);const o=s(3773);const i=s(4294);const a=s(574);class Files extends r.APIResource{create(e,t,s){return this._client.post((0,a.path)`/vector_stores/${e}/files`,{body:t,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){const{vector_store_id:r}=t;return this._client.get((0,a.path)`/vector_stores/${r}/files/${e}`,{...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){const{vector_store_id:r,...n}=t;return this._client.post((0,a.path)`/vector_stores/${r}/files/${e}`,{body:n,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList((0,a.path)`/vector_stores/${e}/files`,n.CursorPage,{query:t,...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){const{vector_store_id:r}=t;return this._client.delete((0,a.path)`/vector_stores/${r}/files/${e}`,{...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){const r=await this.create(e,t,s);return await this.poll(e,r.id,s)}async poll(e,t,s){const r=(0,o.buildHeaders)([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??undefined}]);while(true){const n=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse();const o=n.data;switch(o.status){case"in_progress":let e=5e3;if(s?.pollIntervalMs){e=s.pollIntervalMs}else{const t=n.response.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);if(!isNaN(s)){e=s}}}await(0,i.sleep)(e);break;case"failed":case"completed":return o}}}async upload(e,t,s){const r=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:r.id},s)}async uploadAndPoll(e,t,s){const r=await this.upload(e,t,s);return await this.poll(e,r.id,s)}content(e,t,s){const{vector_store_id:r}=t;return this._client.getAPIList((0,a.path)`/vector_stores/${r}/files/${e}/content`,n.Page,{...s,headers:(0,o.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}t.Files=Files},5324:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.VectorStores=void 0;const r=s(6411);const n=s(4945);const o=r.__importStar(s(5873));const i=s(5873);const a=r.__importStar(s(9271));const l=s(9271);const c=s(5049);const u=s(3773);const d=s(574);class VectorStores extends n.APIResource{constructor(){super(...arguments);this.files=new a.Files(this._client);this.fileBatches=new o.FileBatches(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:(0,u.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get((0,d.path)`/vector_stores/${e}`,{...t,headers:(0,u.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post((0,d.path)`/vector_stores/${e}`,{body:t,...s,headers:(0,u.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",c.CursorPage,{query:e,...t,headers:(0,u.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete((0,d.path)`/vector_stores/${e}`,{...t,headers:(0,u.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList((0,d.path)`/vector_stores/${e}/search`,c.Page,{body:t,method:"post",...s,headers:(0,u.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}t.VectorStores=VectorStores;VectorStores.Files=l.Files;VectorStores.FileBatches=i.FileBatches},907:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});t.Videos=void 0;const r=s(4945);const n=s(5049);const o=s(3773);const i=s(8561);const a=s(574);class Videos extends r.APIResource{create(e,t){return this._client.post("/videos",(0,i.maybeMultipartFormRequestOptions)({body:e,...t},this._client))}retrieve(e,t){return this._client.get((0,a.path)`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",n.ConversationCursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,a.path)`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get((0,a.path)`/videos/${e}/content`,{query:t,...s,headers:(0,o.buildHeaders)([{Accept:"application/binary"},s?.headers]),__binaryResponse:true})}remix(e,t,s){return this._client.post((0,a.path)`/videos/${e}/remix`,(0,i.maybeMultipartFormRequestOptions)({body:t,...s},this._client))}}t.Videos=Videos},221:(e,t,s)=>{var r,n,o;Object.defineProperty(t,"__esModule",{value:true});t.Webhooks=void 0;const i=s(6411);const a=s(9171);const l=s(4945);const c=s(3773);class Webhooks extends l.APIResource{constructor(){super(...arguments);r.add(this)}async unwrap(e,t,s=this._client.webhookSecret,r=300){await this.verifySignature(e,t,s,r);return JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,l=300){if(typeof crypto==="undefined"||typeof crypto.subtle.importKey!=="function"||typeof crypto.subtle.verify!=="function"){throw new Error("Webhook signature verification is only supported when the `crypto` global is defined")}i.__classPrivateFieldGet(this,r,"m",n).call(this,s);const u=(0,c.buildHeaders)([t]).values;const d=i.__classPrivateFieldGet(this,r,"m",o).call(this,u,"webhook-signature");const h=i.__classPrivateFieldGet(this,r,"m",o).call(this,u,"webhook-timestamp");const p=i.__classPrivateFieldGet(this,r,"m",o).call(this,u,"webhook-id");const f=parseInt(h,10);if(isNaN(f)){throw new a.InvalidWebhookSignatureError("Invalid webhook timestamp format")}const m=Math.floor(Date.now()/1e3);if(m-f>l){throw new a.InvalidWebhookSignatureError("Webhook timestamp is too old")}if(f>m+l){throw new a.InvalidWebhookSignatureError("Webhook timestamp is too new")}const _=d.split(" ").map((e=>e.startsWith("v1,")?e.substring(3):e));const g=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8");const b=p?`${p}.${h}.${e}`:`${h}.${e}`;const y=await crypto.subtle.importKey("raw",g,{name:"HMAC",hash:"SHA-256"},false,["verify"]);for(const e of _){try{const t=Buffer.from(e,"base64");const s=await crypto.subtle.verify("HMAC",y,t,(new TextEncoder).encode(b));if(s){return}}catch{continue}}throw new a.InvalidWebhookSignatureError("The given webhook signature does not match the expected signature")}}t.Webhooks=Webhooks;r=new WeakSet,n=function _Webhooks_validateSecret(e){if(typeof e!=="string"||e.length===0){throw new Error(`The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function`)}},o=function _Webhooks_getRequiredHeader(e,t){if(!e){throw new Error(`Headers are required`)}const s=e.get(t);if(s===null||s===undefined){throw new Error(`Missing required header: ${t}`)}return s}},9553:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:true});const r=s(6411);r.__exportStar(s(3173),t)},2177:(e,t)=>{Object.defineProperty(t,"__esModule",{value:true});t.VERSION=void 0;t.VERSION="6.18.0"}};var __webpack_module_cache__={};function __nccwpck_require__(e){var t=__webpack_module_cache__[e];if(t!==undefined){return t.exports}var s=__webpack_module_cache__[e]={exports:{}};var r=true;try{__webpack_modules__[e].call(s.exports,s,s.exports,__nccwpck_require__);r=false}finally{if(r)delete __webpack_module_cache__[e]}return s.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var __webpack_exports__=__nccwpck_require__(6866);module.exports=__webpack_exports__})();